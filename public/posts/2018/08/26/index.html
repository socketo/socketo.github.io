<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp | socketo.github.io</title>
<meta name="keywords" content="Forensics">
<meta name="description" content="※ 移行前の元ブログ記事 : Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include &lt;sys_socket.h&gt;
はじめに インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）
The #Defcon #DFIR #CTF is now open to the public. https://t.co/IdOE23dMzh #infosec— David Cowen (@HECFBlog) 2018年8月13日
Hacking Exposed Computer Forensics Blog Daily Blog #451 Defcon DFIR CTF 2018 Open to the Public : http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Defcon DFIR CTF 2018 : https://defcon2018.ctfd.io/challenges
対象イメージファイル 実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．
http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Image1.7zのパスワードは書いてあるので，それを使う．
Image2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．
やっていったら長くなったので，Image2とImage3については今後書く予定です．
Image 1 : HRServer Image1.">
<meta name="author" content="">
<link rel="canonical" href="https://socketo.github.io/posts/2018/08/26/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css" integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe&#43;FVUFzPh7U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://socketo.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://socketo.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://socketo.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://socketo.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://socketo.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp" />
<meta property="og:description" content="※ 移行前の元ブログ記事 : Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include &lt;sys_socket.h&gt;
はじめに インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）
The #Defcon #DFIR #CTF is now open to the public. https://t.co/IdOE23dMzh #infosec— David Cowen (@HECFBlog) 2018年8月13日
Hacking Exposed Computer Forensics Blog Daily Blog #451 Defcon DFIR CTF 2018 Open to the Public : http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Defcon DFIR CTF 2018 : https://defcon2018.ctfd.io/challenges
対象イメージファイル 実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．
http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Image1.7zのパスワードは書いてあるので，それを使う．
Image2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．
やっていったら長くなったので，Image2とImage3については今後書く予定です．
Image 1 : HRServer Image1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://socketo.github.io/posts/2018/08/26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-26T03:08:15+00:00" />
<meta property="article:modified_time" content="2018-08-26T03:08:15+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp"/>
<meta name="twitter:description" content="※ 移行前の元ブログ記事 : Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include &lt;sys_socket.h&gt;
はじめに インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）
The #Defcon #DFIR #CTF is now open to the public. https://t.co/IdOE23dMzh #infosec— David Cowen (@HECFBlog) 2018年8月13日
Hacking Exposed Computer Forensics Blog Daily Blog #451 Defcon DFIR CTF 2018 Open to the Public : http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Defcon DFIR CTF 2018 : https://defcon2018.ctfd.io/challenges
対象イメージファイル 実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．
http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html
Image1.7zのパスワードは書いてあるので，それを使う．
Image2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．
やっていったら長くなったので，Image2とImage3については今後書く予定です．
Image 1 : HRServer Image1."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://socketo.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp",
      "item": "https://socketo.github.io/posts/2018/08/26/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp",
  "name": "Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp",
  "description": "※ 移行前の元ブログ記事 : Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include \u0026lt;sys_socket.h\u0026gt;\nはじめに インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）\nThe #Defcon #DFIR #CTF is now open to the public. https://t.co/IdOE23dMzh #infosec— David Cowen (@HECFBlog) 2018年8月13日\nHacking Exposed Computer Forensics Blog Daily Blog #451 Defcon DFIR CTF 2018 Open to the Public : http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html\nDefcon DFIR CTF 2018 : https://defcon2018.ctfd.io/challenges\n対象イメージファイル 実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．\nhttp://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html\nImage1.7zのパスワードは書いてあるので，それを使う．\nImage2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．\nやっていったら長くなったので，Image2とImage3については今後書く予定です．\nImage 1 : HRServer Image1.",
  "keywords": [
    "Forensics"
  ],
  "articleBody": "※ 移行前の元ブログ記事 : Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include はじめに インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）\nThe #Defcon #DFIR #CTF is now open to the public. https://t.co/IdOE23dMzh #infosec— David Cowen (@HECFBlog) 2018年8月13日\nHacking Exposed Computer Forensics Blog Daily Blog #451 Defcon DFIR CTF 2018 Open to the Public : http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html\nDefcon DFIR CTF 2018 : https://defcon2018.ctfd.io/challenges\n対象イメージファイル 実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．\nhttp://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html\nImage1.7zのパスワードは書いてあるので，それを使う．\nImage2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．\nやっていったら長くなったので，Image2とImage3については今後書く予定です．\nImage 1 : HRServer Image1.7zを展開すると，HRServer_Disk0.e01とHRServer_Disk0.txtが出てくる． HRServer_Disk0.txtを見ると，X-waysでこのディスクイメージを取得したっぽいことが分かる．\nHRServer_Disk.e01をFTK Imagerで開く．\nWindows Serverっぽい．\nどうせならSIFT Workstationでやるかという気持ちになったので，E01ファイルをSIFT Workstationでマウントする．\nSANS Digital Forensics and Incident Response Blog _ Digital Forensic SIFTing - Mounting Evidence Image Files _ SANS Institute : https://digital-forensics.sans.org/blog/2011/11/28/digital-forensic-sifting-mounting-ewf-or-e01-evidence-image-files\n# ewfmount HRServer_Disk0.e01 /mnt/e01/\n# mmls /mnt/e01/ewf1\nDOS Partition Table Offset Sector: 0 Units are in 512-byte sectors Slot Start End Length Description 000: Meta 0000000000 0000000000 0000000001 Primary Table (#0) 001: ------- 0000000000 0001026047 0001026048 Unallocated 002: 000:000 0001026048 0104857599 0103831552 NTFS / exFAT (0x07) # python Python 2.7.12 (default, Dec 4 2017, 14:50:18) [GCC 5.4.0 20160609] on linux2 Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. \u003e\u003e\u003e 1026048 * 512 525336576 # mount -o ro,loop,show_sys_files,streams_interface=windows,offset=525336576 -t ntfs /mnt/e01/ewf1 /mnt/windows_mount\n確認する\nOK\nHR Server Basic 前情報 HRServer_Disk0.txtの中身する\n08/08/2018, 14:32:43 X-Ways Forensics BYOD 19.6 SR-6 x64 Create Disk Image Computer: DESKTOP-0QT8017 4 processor cores Windows 10 (64 bit) Time zone: -7:00 Pacific Daylight Time User: Administrator Examiner(s): Professor Frink Source: Hard disk 1 Sectors 0-104857599 Model: f-switch BF063FCFC580DB48 Serial No.: DIsk-0 Firmware Rev.: 0001 Bus: SCSI/SATA Total capacity: 53,687,091,200 bytes = 50.0 GB Bytes per sector: 512 Sector count: 104,857,600 SMART: n/a (Incorrect function.) Read consistency: no anomalies detected Partitioning style: MBR Disk signature: 5C2C870D Unpartitionable space: 0 Sectors Partition 1 Sectors 1,026,048 - 104,857,599 Partition table: Sector 0 NTFS Unused inter-partition space: Sectors 0 - 1,026,047 (501 MB) = 501 MB Destination: C:\\Users\\Administrator\\Desktop\\HRServer_Disk0.e01 Hash of source data: BB3E772F1896D23865AC3FE9763691D3 (MD5) 08/08/2018, 20:30:47 Imaging completed: 12.6 GB Duration: 5:58:03 h. 0.1 GB/min. Compression: fast, adaptive Compression ratio: 75% HRServer基本調査 Regripperでレジストリ周りを調べると以下のことが分かる\nWindows OSのバージョン : Windows Server 2016 Datacenter\nTimezoneの確認 : UTC-7\nユーザ\nAdministrator[500] Guest[501] DefaultAccount[503] mpowers[1000] グループ\nGroup Name : Administrators [2] LastWrite : Wed Jul 11 17:22:06 2018 Z Group Comment : Administrators have complete and unrestricted access to the computer/domain Users : S-1-5-21-2967420476-1305424719-3994513216-1000 =\u003e mpowers S-1-5-21-2967420476-1305424719-3994513216-500 =\u003e Administrator HR Server - Acquisition Software(2) 問題文\nWhich software was used to image the HR Server? HRServerのイメージを取得したソフトウェアを答えるだけ．\nHRServer_Disk0.txtに取得時のログか書かれており，X-Ways Forensics BYODで取得されたことがわかるので，それ．\nFLAG:X-Ways\nHR Server - Acquisition Software Version(2) 問題文\nWhich version of the software was used to image the HR Server? [Format: n.n] X-Waysのバージョンを答える．\nFLAG:19.6\nHR Server - Entry Name(2) 問題文\nWhat is the file name that represents MFT Entry 168043? MFTエントリ168043を表すファイル名は何か．\nMFTを解析するのにはanalyzeMFT.pyを使う．\nanalyzeMFT.py : https://github.com/dkovar/analyzeMFT\n# analyzeMFT.py -f \\$MFT.copy0 -o MFT.csv 出力したMFT.csvからエントリ168043を探す\n# cat MFT.csv | grep '\"168043\"'\nFLAG:pip3.7.exe\nHR Server - Entry Number(2) 問題文\nWhat is the MFT Entry number of the following file? \\xampp\\mysql\\bin\\mysql.exe [format is an integer] 逆にファイルからMFATのエントリー番号を探す．\nファイルは\\xampp\\mysql\\bin\\mysql.exe\n# cat MFT.csv | grep '/xampp/mysql/bin/mysql.exe'\nFLAG:115322\nHR Server - Attribute ID(2) 問題文\nWhat is the MFT Attribute ID of the named $J data attribute for the MFT Entry with a file name of $UsnJrnl? [format is an integer] $ Jデータ属性のMFT属性IDをintで答える的は話\nAutopsyでイメージを開く [属性アドレス]が128-3なので3\nFLAG:3\nHR Server - SMB(2) 問題文\nAt 2018-08-08 18:10:38.554 (UTC) what was the IP address of the the client that attempted to access SMB via an anonymous logon? 2018-08-08 18:10:38.554 (UTC)にSMBでanonymous logonを施行したクライアントのIPアドレスを調べる．\n調査用している端末がUTC+9である為，Windowsのイベントビュアーで見ると9時間ズレることになる．\nXMLで表示すると，実際の生のUTCで見れるんでそれで確認する\nIPアドレスが80.81.110.50のクライアントからanonymous logonを施行しているのがある．\nFLAG:80.81.110.50\nHR Server - Saved(2) 問題文\nWhat was the name of the batch file saved by mpowers? [answer is fullpath starting with c:*****] mpowersが保存したバッチファイルの名前は何．\nmpowersのuserassistをregripperを使って見る．\nその中に.batファイルがあればそれっぽいのでそれ．\n# rip.pl -r Users/mpowers/NTUSER.DAT -p userassist | grep bat\nFLAG:c:\\Production\\update_app.bat\nHR Server - Application Q 1(2) 問題文\nWhat is the name of the hr management application that hosts a web server? ホストしているHR Managementのアプリケーションは何？\n/Users/Administrator/Downloadsに以下の実行ファイルがあった\norangehrm-4.1.exe orangehrm_mysql.sql xampp-win32-5.6.36-0-VC11-installer.exe OrangeHRMというオープンソースの人材管理システムがインストールされていたように感じる．\nOrangeHRM - Human Resource Management 日本語情報トップページ - OSDN : https://ja.osdn.net/projects/sfnet_orangehrm/\n/直下にxamppのディレクトリはあるが，xampp/apache/logsにこれといったログは無いので，このOrangeHRMの方のディレクトリを見るべきっぽい．\nOrangeHRMのホームディレクトリは/Program Files/OrangeHRM/4.1になっており，それ以下はxamppと同じようなディレクトリ構造になっているっぽい．\nそんな感じでOrangeHRMですね．はい．\nFLAG:OrangeHRM\nHR Server - Application Q 2(2) 問題文\nWhat was the public url for the HR system's portal? [format: http://*****] /Program Files/OrangeHRM/4.1/apache/logsのaccess.logをザッと見てると，http://127.0.0.1/orangehrm-4.1/symfony/web/*へアクセスしている後にhttp://74.118.139.108/symfony/web/*へのアクセスに変わってる．\nローカルで立てた後にPublicにしたっぽくてhttp://74.118.139.108/symfony/web/index.phpがポータルのトップっぽい．\nFLAG:http://74.118.139.108/symfony/web/index.php/\nHR Server- Changes Q1(2) 問題文\nWhat is name of the file that had a change recorded with an update sequence number of 368701440? USNAnalyticsを使ってUSNジャーナルの解析をする． USNAnalytics:https://www.kazamiya.net/usn_analytics\nC:\\Users\\socketo\\workspace\\DFIR\\DefconDFIR2018\\HRServer\\usn_analysis.exe -o outputdir -u $UsnJrnl$J\n出力されたcsvファイル(tsv)からUSN:368701440を探す．\n# cat usn_analytics_records-20180806T233530.tsv | grep 368701440\nFLAG:Microsoft-Windows-SMBServer%4Security.evtx\nHR Server - Changes Q2(2) 問題文\nWhat is the name of the deleted file with a reference number of 12947848928752043? よくわからん\nHR Server - Advanced HR Server - Logon(4) 問題文\nAt 2018-07-30 22:31:33 UTC which user was logged in under, what was the logon type (integer), and the logon process name? [format: {TargetUserName} - {LogonType} - {LogonProcessName} - {IpAddress}] この時間にログオンしたやつを見つけて上のフォーマットで答える\nこのフォーマット的にSecurityイベントログのようなので/Windows/System32/winevt/Logs/Security.evtxを見たいので見たが，Eventlogの消去が行われていたようで，その時間のイベントログを見ることが出来ない．(UTC+9上の環境で見ている為，時間はズレている)\nSecurity.evtx以外では，RDP関係のイベントが残るイベントログMicrosoft-Windows-TerminalServices-RemoteConnectionManager%4Admin.evtxを見ると，該当の時間にRDPで接続されているように思える．\n一応この時間に接続がされていたようなので，どうにかしてSecurity.evtxを持ってきたい．\n今回は幸いに，/System Volume Information下を見るとVolume Shadow Copyのファイルあるので，それを利用する．\nVolume Shadow CopyをSIFT Workstationにマウントする\n参考動画\n# ewfmount /mnt/hgfs/DefconDFIR2018/HRServer/HRServer_Disk0.e01 /mnt/ewf/\n# mmls /mnt/ewf/ewf1\nDOS Partition Table Offset Sector: 0 Units are in 512-byte sectors Slot Start End Length Description 000: Meta 0000000000 0000000000 0000000001 Primary Table (#0) 001: ------- 0000000000 0001026047 0001026048 Unallocated 002: 000:000 0001026048 0104857599 0103831552 NTFS / exFAT (0x07) # python Python 2.7.12 (default, Dec 4 2017, 14:50:18) [GCC 5.4.0 20160609] on linux2 Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. \u003e\u003e\u003e 1026048 * 512 525336576 \u003e\u003e\u003e exit() # vshadowmount -o 525336576 /mnt/ewf/ewf1 /mnt/vss/\n# mountwin /mnt/vss/vss1 /mnt/shadow_mount/\n確認する\nこのVSSでのイベントログを確認すると，Security.evtxはイメージファイルに現存しているSecurity.evtxよりもサイズが大きいので削除されていないっぽい．\n実際にSecurity.evtxを抽出し，中身を見ると削除される前の状態のものであることが確認できる． 目的の時間のイベントログを探すと以下のイベントログが見つかる．\nこの結果をフォーマットに合わせる\nFLAG:mpowers - 10 - User32 - 74.118.138.195\nHR Server - Task Started(4) 問題文\nAt 2018-07-27 02:42:43 (UTC), what is the name of the task that was started? この時間に始まったタスクを調べるとのこと． イベントログMicrosoft-Windows-TaskScheduler%4Operation.evtxを見る\nThrow Tacoというタスクがこの時間にスケジューラによって開始しているのでそれ．\nFLAG:Throw Taco\nHR Server - HR System 1(4) 問題文\nWhich IP address was accessing the OrangeHRM portal via Chrome 68.0.3440.84? access.logをChrome/68.0.3440.84でgrepする\nFLAG:74.118.139.108\nHR Server - Web App(4) 問題文\nWhat version of Apache was being used? [format: n.n] Apacheのバージョンを調べる\nProgram Files/OrangeHRM/4.1/apacheでApache関係のファイルがあるので見ると，Apache2.4っぽいので2.4\nFLAG:2.4\nHR Server - Changes Q3(4) 問題文\nWhat is the integer representation for the reason code given a USN V2 record where the record's reason flags have the following: USN_REASON_CLOSE | USN_REASON_DATA_EXTEND | USN_REASON_FILE_CREATE USN RECORD V2においてCLOSE，DATA_EXTEND，FILE_CREATEのReasonコードを答える問題．\n以下のMicrosoftのドキュメントを見ると分かる．\nUSN_RECORD_V2 _ Microsoft Docs : https://docs.microsoft.com/en-us/windows/desktop/api/winioctl/ns-winioctl-usn_record_v2\nReason Code USN_REASON_CLOSE 0x80000000 USN_REASON_DATA_EXTEND 0x00000002 USN_REASON_FILE_CREATE 0x00000100 この3つが含まれているコードは0x80000102になる\nこれをdecimalにすると2147483906になる\nFLAG:2147483906\nHR Server - Expert HR Server - Web Traffic Q1(8) 問題文\nWhat was the top communicating IP address with the web server? Webサーバと一番通信していたIPアドレスを探す． 普通にaccess.logで出現したIPアドレスを出現多い順にする\n$ cat access.log | awk '{print $1}' | sort | uniq -c | sort -rn | head\n780 74.118.138.195 361 99.191.150.129 361 73.60.202.108 361 68.34.44.44 211 74.118.139.108 193 24.63.119.107 175 74.56.59.151 139 104.9.181.249 126 47.75.16.178 125 47.90.92.121 FLAG:74.118.138.195\nHR Server - Web Traffic Q2(8) 問題文\nHow many requests were made to the web server where the requested url contained a wget command within in? リクエストされたURLにwgetが含まれた回数を数える． 普通にgrepして数える\n$ cat access.log| grep wget | wc -l\n101 FLAG:101\n",
  "wordCount" : "1080",
  "inLanguage": "en",
  "datePublished": "2018-08-26T03:08:15Z",
  "dateModified": "2018-08-26T03:08:15Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://socketo.github.io/posts/2018/08/26/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "socketo.github.io",
    "logo": {
      "@type": "ImageObject",
      "url": "https://socketo.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://socketo.github.io" accesskey="h" title="socketo.github.io (Alt + H)">socketo.github.io</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://socketo.github.io/posts" title="posts">
                    <span><i class='fa fa-heart'></i>posts</span>
                </a>
            </li>
            <li>
                <a href="https://socketo.github.io/about" title="about">
                    <span><i class='fa fa-heart'></i>about</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp
    </h1>
    <div class="post-meta"><span title='2018-08-26 03:08:15 +0000 UTC'>August 26, 2018</span>

</div>
  </header> 
  <div class="post-content"><p>※ 移行前の元ブログ記事 : <a href="https://socketo.hatenablog.jp/entry/2018/08/26/030815">Defcon DFIR CTF 2018 # Image1 - HRServer WriteUp - #include &lt;sys_socket.h&gt;</a></p>
<h2 id="はじめに">はじめに<a hidden class="anchor" aria-hidden="true" href="#はじめに">#</a></h2>
<p>インターネットを眺めていたら，Magnet Forensicsが開催してaいたDFIRのCTF「Defcon DFIR CTF 2018」が公開されていたのでやった話（全部は解けていない）</p>
<blockquote>
<p>The <a href="https://twitter.com/hashtag/Defcon?src=hash&amp;ref_src=twsrc%5Etfw">#Defcon</a> <a href="https://twitter.com/hashtag/DFIR?src=hash&amp;ref_src=twsrc%5Etfw">#DFIR</a> <a href="https://twitter.com/hashtag/CTF?src=hash&amp;ref_src=twsrc%5Etfw">#CTF</a> is now open to the public. <a href="https://t.co/IdOE23dMzh">https://t.co/IdOE23dMzh</a> <a href="https://twitter.com/hashtag/infosec?src=hash&amp;ref_src=twsrc%5Etfw">#infosec</a>— David Cowen (@HECFBlog) <a href="https://twitter.com/HECFBlog/status/1029099210556284939?ref_src=twsrc%5Etfw">2018年8月13日</a></p>
</blockquote>
<p>Hacking Exposed Computer Forensics Blog <em>Daily Blog #451</em> Defcon DFIR CTF 2018 Open to the Public : <a href="http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html">http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html</a></p>
<p>Defcon DFIR CTF 2018 : <a href="https://defcon2018.ctfd.io/challenges">https://defcon2018.ctfd.io/challenges</a></p>
<h2 id="対象イメージファイル">対象イメージファイル<a hidden class="anchor" aria-hidden="true" href="#対象イメージファイル">#</a></h2>
<p>実際に調査するイメージファイルは以下のブログのDropboxのリンクからImage1，Image2，Image3と3つダウンロードできる．</p>
<p><a href="http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html">http://www.hecfblog.com/2018/08/daily-blog-451-defcon-dfir-ctf-2018.html</a></p>
<p>Image1.7zのパスワードは書いてあるので，それを使う．</p>
<p>Image2.7z，Image3.7zのパスワードはCTFの問題を解いていくと分かる．</p>
<p>やっていったら長くなったので，Image2とImage3については今後書く予定です．</p>
<h2 id="image-1--hrserver">Image 1 : HRServer<a hidden class="anchor" aria-hidden="true" href="#image-1--hrserver">#</a></h2>
<p><code>Image1.7z</code>を展開すると，<code>HRServer_Disk0.e01</code>と<code>HRServer_Disk0.txt</code>が出てくる．
<code>HRServer_Disk0.txt</code>を見ると，X-waysでこのディスクイメージを取得したっぽいことが分かる．</p>
<p><code>HRServer_Disk.e01</code>をFTK Imagerで開く．</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023119.png" alt="f:id:socketo:20180826023119p:plain"  title="f:id:socketo:20180826023119p:plain"  />
<!-- raw HTML omitted --></p>
<p>Windows Serverっぽい．</p>
<p>どうせならSIFT Workstationでやるかという気持ちになったので，E01ファイルをSIFT Workstationでマウントする．</p>
<p>SANS Digital Forensics and Incident Response Blog _ Digital Forensic SIFTing - Mounting Evidence Image Files _ SANS Institute : <a href="https://digital-forensics.sans.org/blog/2011/11/28/digital-forensic-sifting-mounting-ewf-or-e01-evidence-image-files">https://digital-forensics.sans.org/blog/2011/11/28/digital-forensic-sifting-mounting-ewf-or-e01-evidence-image-files</a></p>
<p><code># ewfmount HRServer_Disk0.e01 /mnt/e01/</code></p>
<p><code># mmls /mnt/e01/ewf1</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>DOS Partition Table
</span></span><span style="display:flex;"><span>Offset Sector: 0
</span></span><span style="display:flex;"><span>Units are in 512-byte sectors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Slot      Start        End          Length       Description
</span></span><span style="display:flex;"><span>000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
</span></span><span style="display:flex;"><span>001:  -------   0000000000   0001026047   0001026048   Unallocated
</span></span><span style="display:flex;"><span>002:  000:000   0001026048   0104857599   0103831552   NTFS / exFAT (0x07)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># python</span>
</span></span><span style="display:flex;"><span>Python <span style="color:#ae81ff">2.7.12</span> (default, Dec  <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">2017</span>, <span style="color:#ae81ff">14</span>:<span style="color:#ae81ff">50</span>:<span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>[GCC <span style="color:#ae81ff">5.4.0</span> <span style="color:#ae81ff">20160609</span>] on linux2
</span></span><span style="display:flex;"><span>Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">1026048</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">525336576</span>
</span></span></code></pre></div><p><code># mount -o ro,loop,show_sys_files,streams_interface=windows,offset=525336576 -t ntfs /mnt/e01/ewf1 /mnt/windows_mount</code></p>
<p>確認する</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023220.png" alt="f:id:socketo:20180826023220p:plain"  title="f:id:socketo:20180826023220p:plain"  />
<!-- raw HTML omitted --></p>
<p>OK</p>
<h2 id="hr-server-basic">HR Server Basic<a hidden class="anchor" aria-hidden="true" href="#hr-server-basic">#</a></h2>
<h3 id="前情報">前情報<a hidden class="anchor" aria-hidden="true" href="#前情報">#</a></h3>
<p><code>HRServer_Disk0.txt</code>の中身する</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>08/08/2018, 14:32:43
</span></span><span style="display:flex;"><span>X-Ways Forensics BYOD 19.6 SR-6 x64
</span></span><span style="display:flex;"><span>Create Disk Image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Computer: DESKTOP-0QT8017
</span></span><span style="display:flex;"><span>4 processor cores
</span></span><span style="display:flex;"><span>Windows 10 (64 bit)
</span></span><span style="display:flex;"><span>Time zone: -7:00 Pacific Daylight Time
</span></span><span style="display:flex;"><span>User: Administrator
</span></span><span style="display:flex;"><span>Examiner(s): Professor Frink
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Source: Hard disk 1
</span></span><span style="display:flex;"><span>Sectors 0-104857599
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Model: f-switch BF063FCFC580DB48
</span></span><span style="display:flex;"><span>Serial No.: DIsk-0
</span></span><span style="display:flex;"><span>Firmware Rev.: 0001
</span></span><span style="display:flex;"><span>Bus: SCSI/SATA
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total capacity: 53,687,091,200 bytes = 50.0 GB
</span></span><span style="display:flex;"><span>Bytes per sector: 512
</span></span><span style="display:flex;"><span>Sector count: 104,857,600
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SMART: n/a (Incorrect function.)
</span></span><span style="display:flex;"><span>Read consistency: no anomalies detected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Partitioning style: MBR
</span></span><span style="display:flex;"><span>Disk signature: 5C2C870D
</span></span><span style="display:flex;"><span>Unpartitionable space: 0 Sectors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Partition 1
</span></span><span style="display:flex;"><span>Sectors 1,026,048 - 104,857,599
</span></span><span style="display:flex;"><span>Partition table: Sector 0
</span></span><span style="display:flex;"><span>NTFS
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Unused inter-partition space:
</span></span><span style="display:flex;"><span>Sectors 0 - 1,026,047 (501 MB)
</span></span><span style="display:flex;"><span>= 501 MB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Destination: C:\Users\Administrator\Desktop\HRServer_Disk0.e01
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Hash of source data: BB3E772F1896D23865AC3FE9763691D3 (MD5)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>08/08/2018, 20:30:47
</span></span><span style="display:flex;"><span>Imaging completed: 12.6 GB
</span></span><span style="display:flex;"><span>Duration: 5:58:03 h. 0.1 GB/min.
</span></span><span style="display:flex;"><span>Compression: fast, adaptive
</span></span><span style="display:flex;"><span>Compression ratio: 75%
</span></span></code></pre></div><h3 id="hrserver基本調査">HRServer基本調査<a hidden class="anchor" aria-hidden="true" href="#hrserver基本調査">#</a></h3>
<p>Regripperでレジストリ周りを調べると以下のことが分かる</p>
<ul>
<li>
<p>Windows OSのバージョン : Windows Server 2016 Datacenter</p>
</li>
<li>
<p>Timezoneの確認 : UTC-7</p>
</li>
<li>
<p>ユーザ</p>
<ul>
<li>Administrator[500]</li>
<li>Guest[501]</li>
<li>DefaultAccount[503]</li>
<li>mpowers[1000]</li>
</ul>
</li>
<li>
<p>グループ</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>    Group Name    : Administrators [2]
</span></span><span style="display:flex;"><span>LastWrite     : Wed Jul 11 17:22:06 2018 Z
</span></span><span style="display:flex;"><span>Group Comment : Administrators have complete and unrestricted access to the computer/domain
</span></span><span style="display:flex;"><span>Users :
</span></span><span style="display:flex;"><span>S-1-5-21-2967420476-1305424719-3994513216-1000     =&gt; mpowers
</span></span><span style="display:flex;"><span>S-1-5-21-2967420476-1305424719-3994513216-500       =&gt; Administrator
</span></span></code></pre></div><h3 id="hr-server---acquisition-software2">HR Server - Acquisition Software(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---acquisition-software2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Which software was used to image the HR Server?
</span></span></code></pre></div><p>HRServerのイメージを取得したソフトウェアを答えるだけ．</p>
<p>HRServer_Disk0.txtに取得時のログか書かれており，X-Ways Forensics BYODで取得されたことがわかるので，それ．</p>
<p>FLAG:<code>X-Ways</code></p>
<h3 id="hr-server---acquisition-software-version2">HR Server - Acquisition Software Version(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---acquisition-software-version2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Which version of the software was used to image the HR Server? [Format: n.n]
</span></span></code></pre></div><p>X-Waysのバージョンを答える．</p>
<p>FLAG:<code>19.6</code></p>
<h3 id="hr-server---entry-name2">HR Server - Entry Name(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---entry-name2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the file name that represents MFT Entry 168043?
</span></span></code></pre></div><p>MFTエントリ168043を表すファイル名は何か．</p>
<p>MFTを解析するのにはanalyzeMFT.pyを使う．</p>
<p>analyzeMFT.py : <a href="https://github.com/dkovar/analyzeMFT">https://github.com/dkovar/analyzeMFT</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># analyzeMFT.py -f \$MFT.copy0 -o MFT.csv
</span></span></code></pre></div><p>出力した<code>MFT.csv</code>からエントリ168043を探す</p>
<p><code># cat MFT.csv | grep '&quot;168043&quot;'</code></p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023558.png" alt="f:id:socketo:20180826023558p:plain"  title="f:id:socketo:20180826023558p:plain"  />
<!-- raw HTML omitted --></p>
<p>FLAG:<code>pip3.7.exe</code></p>
<h3 id="hr-server---entry-number2">HR Server - Entry Number(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---entry-number2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the MFT Entry number of the following file? \xampp\mysql\bin\mysql.exe
</span></span><span style="display:flex;"><span>[format is an integer]
</span></span></code></pre></div><p>逆にファイルからMFATのエントリー番号を探す．</p>
<p>ファイルは<code>\xampp\mysql\bin\mysql.exe</code></p>
<p><code># cat MFT.csv | grep '/xampp/mysql/bin/mysql.exe'</code></p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023703.png" alt="f:id:socketo:20180826023703p:plain"  title="f:id:socketo:20180826023703p:plain"  />
<!-- raw HTML omitted --></p>
<p>FLAG:<code>115322</code></p>
<h3 id="hr-server---attribute-id2">HR Server - Attribute ID(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---attribute-id2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the MFT Attribute ID of the named $J data attribute for the MFT Entry with a file name of $UsnJrnl?
</span></span><span style="display:flex;"><span>[format is an integer]
</span></span></code></pre></div><p>$ Jデータ属性のMFT属性IDをintで答える的は話</p>
<p>Autopsyでイメージを開く
<!-- raw HTML omitted --><img loading="lazy" src="20180826023754.png" alt="f:id:socketo:20180826023754p:plain"  title="f:id:socketo:20180826023754p:plain"  />
<!-- raw HTML omitted --></p>
<p>[属性アドレス]が<code>128-3</code>なので<code>3</code></p>
<p>FLAG:<code>3</code></p>
<h3 id="hr-server---smb2">HR Server - SMB(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---smb2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>At 2018-08-08 18:10:38.554 (UTC) what was the IP address of the the client that attempted to access SMB via an anonymous logon?
</span></span></code></pre></div><p>2018-08-08 18:10:38.554 (UTC)にSMBでanonymous logonを施行したクライアントのIPアドレスを調べる．</p>
<p>調査用している端末がUTC+9である為，Windowsのイベントビュアーで見ると9時間ズレることになる．</p>
<p>XMLで表示すると，実際の生のUTCで見れるんでそれで確認する</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023830.png" alt="f:id:socketo:20180826023830p:plain"  title="f:id:socketo:20180826023830p:plain"  />
<!-- raw HTML omitted --></p>
<p>IPアドレスが<code>80.81.110.50</code>のクライアントからanonymous logonを施行しているのがある．</p>
<p>FLAG:<code>80.81.110.50</code></p>
<h3 id="hr-server---saved2">HR Server - Saved(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---saved2">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What was the name of the batch file saved by mpowers?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[answer is fullpath starting with c:*****]
</span></span></code></pre></div><p><code>mpowers</code>が保存したバッチファイルの名前は何．</p>
<p><code>mpowers</code>のuserassistをregripperを使って見る．</p>
<p>その中に.batファイルがあればそれっぽいのでそれ．</p>
<p><code># rip.pl -r Users/mpowers/NTUSER.DAT -p userassist | grep bat</code></p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826023909.png" alt="f:id:socketo:20180826023909p:plain"  title="f:id:socketo:20180826023909p:plain"  />
<!-- raw HTML omitted --></p>
<p>FLAG:<code>c:\Production\update_app.bat</code></p>
<h3 id="hr-server---application-q-12">HR Server - Application Q 1(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---application-q-12">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the name of the hr management application that hosts a web server?
</span></span></code></pre></div><p>ホストしているHR Managementのアプリケーションは何？</p>
<p><code>/Users/Administrator/Downloads</code>に以下の実行ファイルがあった</p>
<ul>
<li><code>orangehrm-4.1.exe</code></li>
<li><code>orangehrm_mysql.sql</code></li>
<li><code>xampp-win32-5.6.36-0-VC11-installer.exe</code></li>
</ul>
<p><code>OrangeHRM</code>というオープンソースの人材管理システムがインストールされていたように感じる．</p>
<p>OrangeHRM - Human Resource Management 日本語情報トップページ - OSDN : <a href="https://ja.osdn.net/projects/sfnet_orangehrm/">https://ja.osdn.net/projects/sfnet_orangehrm/</a></p>
<p>/直下に<code>xampp</code>のディレクトリはあるが，<code>xampp/apache/logs</code>にこれといったログは無いので，このOrangeHRMの方のディレクトリを見るべきっぽい．</p>
<p>OrangeHRMのホームディレクトリは<code>/Program Files/OrangeHRM/4.1</code>になっており，それ以下はxamppと同じようなディレクトリ構造になっているっぽい．</p>
<p>そんな感じでOrangeHRMですね．はい．</p>
<p>FLAG:<code>OrangeHRM</code></p>
<h3 id="hr-server---application-q-22">HR Server - Application Q 2(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---application-q-22">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What was the public url for the HR system&#39;s portal?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[format: http://*****]
</span></span></code></pre></div><p><code>/Program Files/OrangeHRM/4.1/apache/logs</code>の<code>access.log</code>をザッと見てると，<code>http://127.0.0.1/orangehrm-4.1/symfony/web/*</code>へアクセスしている後に<code>http://74.118.139.108/symfony/web/*</code>へのアクセスに変わってる．</p>
<p>ローカルで立てた後にPublicにしたっぽくて<code>http://74.118.139.108/symfony/web/index.php</code>がポータルのトップっぽい．</p>
<p>FLAG:<code>http://74.118.139.108/symfony/web/index.php/</code></p>
<h3 id="hr-server--changes-q12">HR Server- Changes Q1(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server--changes-q12">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is name of the file that had a change recorded with an update sequence number of 368701440?
</span></span></code></pre></div><p>USNAnalyticsを使ってUSNジャーナルの解析をする．
USNAnalytics:https://www.kazamiya.net/usn_analytics</p>
<p><code>C:\Users\socketo\workspace\DFIR\DefconDFIR2018\HRServer\usn_analysis.exe -o outputdir -u $UsnJrnl$J</code></p>
<p>出力されたcsvファイル(tsv)からUSN:<code>368701440</code>を探す．</p>
<p><code># cat usn_analytics_records-20180806T233530.tsv | grep 368701440</code></p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826025609.png" alt="f:id:socketo:20180826025609p:plain"  title="f:id:socketo:20180826025609p:plain"  />
<!-- raw HTML omitted --></p>
<p>FLAG:<code>Microsoft-Windows-SMBServer%4Security.evtx</code></p>
<h3 id="hr-server---changes-q22">HR Server - Changes Q2(2)<a hidden class="anchor" aria-hidden="true" href="#hr-server---changes-q22">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the name of the deleted file with a reference number of 12947848928752043?
</span></span></code></pre></div><p>よくわからん</p>
<h2 id="hr-server---advanced">HR Server - Advanced<a hidden class="anchor" aria-hidden="true" href="#hr-server---advanced">#</a></h2>
<h3 id="hr-server---logon4">HR Server - Logon(4)<a hidden class="anchor" aria-hidden="true" href="#hr-server---logon4">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>At 2018-07-30 22:31:33 UTC which user was logged in under, what was the logon type (integer), and the logon process name?
</span></span><span style="display:flex;"><span>[format: {TargetUserName} - {LogonType} - {LogonProcessName} - {IpAddress}]
</span></span></code></pre></div><p>この時間にログオンしたやつを見つけて上のフォーマットで答える</p>
<p>このフォーマット的にSecurityイベントログのようなので<code>/Windows/System32/winevt/Logs/Security.evtx</code>を見たいので見たが，Eventlogの消去が行われていたようで，その時間のイベントログを見ることが出来ない．(UTC+9上の環境で見ている為，時間はズレている)</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024121.png" alt="f:id:socketo:20180826024121p:plain"  title="f:id:socketo:20180826024121p:plain"  />
<!-- raw HTML omitted --></p>
<p><code>Security.evtx</code>以外では，RDP関係のイベントが残るイベントログ<code>Microsoft-Windows-TerminalServices-RemoteConnectionManager%4Admin.evtx</code>を見ると，該当の時間にRDPで接続されているように思える．</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024159.png" alt="f:id:socketo:20180826024159p:plain"  title="f:id:socketo:20180826024159p:plain"  />
<!-- raw HTML omitted --></p>
<p>一応この時間に接続がされていたようなので，どうにかしてSecurity.evtxを持ってきたい．</p>
<p>今回は幸いに，<code>/System Volume Information</code>下を見るとVolume Shadow Copyのファイルあるので，それを利用する．</p>
<p>Volume Shadow CopyをSIFT Workstationにマウントする</p>
<!-- raw HTML omitted -->
<p>参考動画</p>
<p><code># ewfmount /mnt/hgfs/DefconDFIR2018/HRServer/HRServer_Disk0.e01 /mnt/ewf/</code></p>
<p><code># mmls /mnt/ewf/ewf1</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>DOS Partition Table
</span></span><span style="display:flex;"><span>Offset Sector: 0
</span></span><span style="display:flex;"><span>Units are in 512-byte sectors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Slot      Start        End          Length       Description
</span></span><span style="display:flex;"><span>000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
</span></span><span style="display:flex;"><span>001:  -------   0000000000   0001026047   0001026048   Unallocated
</span></span><span style="display:flex;"><span>002:  000:000   0001026048   0104857599   0103831552   NTFS / exFAT (0x07)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># python</span>
</span></span><span style="display:flex;"><span>Python <span style="color:#ae81ff">2.7.12</span> (default, Dec  <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">2017</span>, <span style="color:#ae81ff">14</span>:<span style="color:#ae81ff">50</span>:<span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>[GCC <span style="color:#ae81ff">5.4.0</span> <span style="color:#ae81ff">20160609</span>] on linux2
</span></span><span style="display:flex;"><span>Type <span style="color:#e6db74">&#34;help&#34;</span>, <span style="color:#e6db74">&#34;copyright&#34;</span>, <span style="color:#e6db74">&#34;credits&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;license&#34;</span> <span style="color:#66d9ef">for</span> more information<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#ae81ff">1026048</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">525336576</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> exit()
</span></span></code></pre></div><p><code># vshadowmount -o 525336576 /mnt/ewf/ewf1 /mnt/vss/</code></p>
<p><code># mountwin /mnt/vss/vss1 /mnt/shadow_mount/</code></p>
<p>確認する</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024252.png" alt="f:id:socketo:20180826024252p:plain"  title="f:id:socketo:20180826024252p:plain"  />
<!-- raw HTML omitted --></p>
<p>このVSSでのイベントログを確認すると，Security.evtxはイメージファイルに現存しているSecurity.evtxよりもサイズが大きいので削除されていないっぽい．</p>
<p>実際にSecurity.evtxを抽出し，中身を見ると削除される前の状態のものであることが確認できる．
目的の時間のイベントログを探すと以下のイベントログが見つかる．</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024320.png" alt="f:id:socketo:20180826024320p:plain"  title="f:id:socketo:20180826024320p:plain"  />
<!-- raw HTML omitted --></p>
<p>この結果をフォーマットに合わせる</p>
<p>FLAG:<code>mpowers - 10 - User32 - 74.118.138.195</code></p>
<h3 id="hr-server---task-started4">HR Server - Task Started(4)<a hidden class="anchor" aria-hidden="true" href="#hr-server---task-started4">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>At 2018-07-27 02:42:43 (UTC), what is the name of the task that was started?
</span></span></code></pre></div><p>この時間に始まったタスクを調べるとのこと．
イベントログ<code>Microsoft-Windows-TaskScheduler%4Operation.evtx</code>を見る</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024353.png" alt="f:id:socketo:20180826024353p:plain"  title="f:id:socketo:20180826024353p:plain"  />
<!-- raw HTML omitted --></p>
<p><code>Throw Taco</code>というタスクがこの時間にスケジューラによって開始しているのでそれ．</p>
<p>FLAG:<code>Throw Taco</code></p>
<h3 id="hr-server---hr-system-14">HR Server - HR System 1(4)<a hidden class="anchor" aria-hidden="true" href="#hr-server---hr-system-14">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Which IP address was accessing the OrangeHRM portal via Chrome 68.0.3440.84?
</span></span></code></pre></div><p><code>access.log</code>を<code>Chrome/68.0.3440.84</code>でgrepする</p>
<p><!-- raw HTML omitted --><img loading="lazy" src="20180826024427.png" alt="f:id:socketo:20180826024427p:plain"  title="f:id:socketo:20180826024427p:plain"  />
<!-- raw HTML omitted --></p>
<p>FLAG:<code>74.118.139.108</code></p>
<h3 id="hr-server---web-app4">HR Server - Web App(4)<a hidden class="anchor" aria-hidden="true" href="#hr-server---web-app4">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What version of Apache was being used?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[format: n.n]
</span></span></code></pre></div><p>Apacheのバージョンを調べる</p>
<p><code>Program Files/OrangeHRM/4.1/apache</code>でApache関係のファイルがあるので見ると，Apache2.4っぽいので<code>2.4</code></p>
<p>FLAG:<code>2.4</code></p>
<h3 id="hr-server---changes-q34">HR Server - Changes Q3(4)<a hidden class="anchor" aria-hidden="true" href="#hr-server---changes-q34">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What is the integer representation for the reason code given a USN V2 record where the record&#39;s reason flags have the following:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>USN_REASON_CLOSE | USN_REASON_DATA_EXTEND | USN_REASON_FILE_CREATE
</span></span></code></pre></div><p>USN RECORD V2において<code>CLOSE</code>，<code>DATA_EXTEND</code>，<code>FILE_CREATE</code>のReasonコードを答える問題．</p>
<p>以下のMicrosoftのドキュメントを見ると分かる．</p>
<p>USN_RECORD_V2 _ Microsoft Docs : <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winioctl/ns-winioctl-usn_record_v2">https://docs.microsoft.com/en-us/windows/desktop/api/winioctl/ns-winioctl-usn_record_v2</a></p>
<table>
<thead>
<tr>
<th>Reason</th>
<th>Code</th>
</tr>
</thead>
<tbody>
<tr>
<td>USN_REASON_CLOSE</td>
<td>0x80000000</td>
</tr>
<tr>
<td>USN_REASON_DATA_EXTEND</td>
<td>0x00000002</td>
</tr>
<tr>
<td>USN_REASON_FILE_CREATE</td>
<td>0x00000100</td>
</tr>
</tbody>
</table>
<p>この3つが含まれているコードは<code>0x80000102</code>になる</p>
<p>これをdecimalにすると<code>2147483906</code>になる</p>
<p>FLAG:<code>2147483906</code></p>
<h2 id="hr-server---expert">HR Server - Expert<a hidden class="anchor" aria-hidden="true" href="#hr-server---expert">#</a></h2>
<h3 id="hr-server---web-traffic-q18">HR Server - Web Traffic Q1(8)<a hidden class="anchor" aria-hidden="true" href="#hr-server---web-traffic-q18">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>What was the top communicating IP address with the web server?
</span></span></code></pre></div><p>Webサーバと一番通信していたIPアドレスを探す．
普通に<code>access.log</code>で出現したIPアドレスを出現多い順にする</p>
<p><code>$ cat access.log | awk '{print $1}' | sort | uniq -c | sort -rn | head</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span> 780 74.118.138.195
</span></span><span style="display:flex;"><span>361 99.191.150.129
</span></span><span style="display:flex;"><span>361 73.60.202.108
</span></span><span style="display:flex;"><span>361 68.34.44.44
</span></span><span style="display:flex;"><span>211 74.118.139.108
</span></span><span style="display:flex;"><span>193 24.63.119.107
</span></span><span style="display:flex;"><span>175 74.56.59.151
</span></span><span style="display:flex;"><span>139 104.9.181.249
</span></span><span style="display:flex;"><span>126 47.75.16.178
</span></span><span style="display:flex;"><span>125 47.90.92.121
</span></span></code></pre></div><p>FLAG:<code>74.118.138.195</code></p>
<h3 id="hr-server---web-traffic-q28">HR Server - Web Traffic Q2(8)<a hidden class="anchor" aria-hidden="true" href="#hr-server---web-traffic-q28">#</a></h3>
<p>問題文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>How many requests were made to the web server where the requested url contained a wget command within in?
</span></span></code></pre></div><p>リクエストされたURLにwgetが含まれた回数を数える．
普通にgrepして数える</p>
<p><code>$ cat access.log| grep wget | wc -l</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>101
</span></span></code></pre></div><p>FLAG:<code>101</code></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://socketo.github.io/tags/forensics/">Forensics</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://socketo.github.io">socketo.github.io</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
